# Databricks notebook source
# MAGIC %md
# MAGIC ## ICE_AAS.TBL_AAS_CLAIM_SUMMARY
# MAGIC

# COMMAND ----------

# MAGIC %sql
# MAGIC
# MAGIC DROP TEMPORARY VARIABLE IF EXISTS NUMBEROFDAYS;
# MAGIC DECLARE VARIABLE NUMBEROFDAYS INT;
# MAGIC
# MAGIC SET VARIABLE NUMBEROFDAYS = 
# MAGIC CASE 
# MAGIC   WHEN DATEPART('DOW', CURRENT_DATE()) = 1 THEN 6
# MAGIC   WHEN DATEPART('DOW', CURRENT_DATE()) = 2 THEN 7
# MAGIC   ELSE (DATEPART('DOW', CURRENT_DATE()) - 1)
# MAGIC END;
# MAGIC
# MAGIC DROP TABLE IF EXISTS ICE_AAS.TBL_AAS_CLAIM_SUMMARY;
# MAGIC
# MAGIC CREATE TABLE ICE_AAS.TBL_AAS_CLAIM_SUMMARY AS (
# MAGIC
# MAGIC SELECT
# MAGIC   DISTINCT DC.claim_id,
# MAGIC   DC.claim_number,
# MAGIC   DC.EXTERNAL_REFERENCE AS UICLReference,
# MAGIC   TC.position_code,
# MAGIC   TC.Status_code,
# MAGIC   TC.reopened_date,
# MAGIC   TC.closed_date,CASE
# MAGIC     WHEN DC.NOTIFICATION_METHOD IS NULL THEN 'VOICE'
# MAGIC     WHEN DC.NOTIFICATION_METHOD = 'CUSTOMER_PORTAL' THEN 'ENOL'
# MAGIC     ELSE DC.NOTIFICATION_METHOD
# MAGIC   END AS Notify_Method,CASE
# MAGIC     WHEN FNOLINCOMPLETE.CLAIM_NUMBER IS NOT NULL THEN 1
# MAGIC     ELSE 0
# MAGIC   END AS FNOLIncomplete,
# MAGIC   POLICY.policy_number,
# MAGIC   POLICY.INCEPTION_DATE,
# MAGIC   POLICY.POLICY_PERIOD_START,(
# MAGIC     SELECT
# MAGIC       ORGANISATION_NAME
# MAGIC     FROM
# MAGIC       hive_metastore.ice_aas.ice_trn_claim_party TCP
# MAGIC       INNER JOIN hive_metastore.ice_aas.ice_dim_claim_party DCP ON TCP.CLAIM_PARTY_ID = DCP.PARTY_ID
# MAGIC       AND DCP.CURRENT_FLAG = 'Y'
# MAGIC       AND NATURE = 'INSURER'
# MAGIC     WHERE
# MAGIC       TCP.CLAIM_ID = DC.CLAIM_ID
# MAGIC     ORDER BY
# MAGIC       FACT_EFFECTIVE_DATE ASC
# MAGIC     LIMIT
# MAGIC       1
# MAGIC   ) AS Organisation_name,CASE
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('102', '103', '173', 'DC_DC', 'DC_DE', 'DC_DI') THEN 'AA UICL'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('105', '148', '194', 'BG_JL', 'BG_JJ', 'BG_JK') THEN 'AGEAS'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('188') THEN 'AICL'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('178', 'NU_D3', 'NU_D0', 'NU_D4') THEN 'AVIVA'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('126') THEN 'AXA'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('183') THEN 'CIS'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('141', 'HX_C1', 'HX_C6', 'HX_CF') THEN 'COVEA'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN (
# MAGIC       '165',
# MAGIC       '144',
# MAGIC       '189',
# MAGIC       'HW_L1',
# MAGIC       'HW_L8',
# MAGIC       'V8_LC',
# MAGIC       'V8_LG',
# MAGIC       'V8_LB'
# MAGIC     ) THEN 'LV'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('196', '166', '193', 'GW_PY', 'GW_P0') THEN 'PREMIER'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('181', '175', '168') THEN 'ZENITH'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('198', '172') THEN 'ZURICH'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('169') THEN 'PRESTIGE'
# MAGIC     WHEN POLICY.AFFINITY_CODE IN ('SU_W5') THEN 'SOMERSET BRIDGE'
# MAGIC     ELSE NULL
# MAGIC   END AS PanelInsurer,
# MAGIC   CASE
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '11%' THEN 'HBHF'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '010%' THEN 'NATWEST'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '07%' THEN 'NBSFLEXPLUS'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '635601%' THEN 'ROADSIDE'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '000%' THEN 'ROADSIDE'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '60%' THEN 'ROADSIDE'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '15%' THEN 'RBS'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '16%' THEN 'RBS'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '12%' THEN 'RBS'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '30%' THEN 'LTPL'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND (
# MAGIC       POLICY.POLICY_NUMBER LIKE '770%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '771%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '772%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '773%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '774%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '775%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '776%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '777%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '778%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '779%'
# MAGIC     ) THEN 'LTPL'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '80%' THEN 'LTPL'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '87%' THEN 'TSB'
# MAGIC     ELSE POLICY.AFFINITY_CODE
# MAGIC   END AS affinity_code,CASE
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '11%' THEN 'HALIFAX'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '010%' THEN 'NW'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '635601%' THEN 'AA MEMBER'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '000%' THEN 'AA MEMBER'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '60%' THEN 'AA MEMBER'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '07%' THEN 'NBSFLEXPLUS'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '15%' THEN 'ROYAL BANK OF SCOTLAND'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '16%' THEN 'ROYAL BANK OF SCOTLAND'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '12%' THEN 'ROYAL BANK OF SCOTLAND'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '30%' THEN 'LLOYDS BANK'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND (
# MAGIC       POLICY.POLICY_NUMBER LIKE '770%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '771%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '772%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '773%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '774%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '775%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '776%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '777%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '778%'
# MAGIC       OR POLICY.POLICY_NUMBER LIKE '779%'
# MAGIC     ) THEN 'LLOYDS BANK'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '80%' THEN 'LLOYDS BANK'
# MAGIC     WHEN POLICY.AFFINITY_CODE IS NULL
# MAGIC     AND POLICY.POLICY_NUMBER LIKE '87%' THEN 'TSB BANK'
# MAGIC     ELSE POLICY.AFFINITY_DESCRIPTION
# MAGIC   END AS affinity_description,CASE
# MAGIC     WHEN POLICY.POLICY_NUMBER IS NULL
# MAGIC     AND DC.CLAIM_NUMBER LIKE 'AAS%'
# MAGIC     AND DCP.ORGANISATION_NAME IN (
# MAGIC       'AA UNDERWRITING',
# MAGIC       'AA UNDERWRITING NM',
# MAGIC       'AA UNDERWRITING SMART',
# MAGIC       'AA SILVER',
# MAGIC       'AA GOLD',
# MAGIC       'AA PLATINUM'
# MAGIC     ) THEN 'AAUICL'
# MAGIC     WHEN POLICY.POLICY_NUMBER IS NULL
# MAGIC     AND DC.CLAIM_NUMBER LIKE 'AAS%'
# MAGIC     AND DCP.ORGANISATION_NAME IS NOT NULL THEN 'PANEL'
# MAGIC     WHEN POLICY.POLICY_NUMBER IS NULL
# MAGIC     AND DC.CLAIM_NUMBER LIKE 'MEM%' THEN 'MEMBER'
# MAGIC     WHEN POLICY.POLICY_NUMBER IS NOT NULL
# MAGIC     AND DC.CLAIM_NUMBER LIKE 'AAS%'
# MAGIC     AND POLICY.POLICY_NUMBER LIKE 'AAPMB%' THEN 'AAUICL'
# MAGIC     WHEN POLICY.POLICY_NUMBER IS NOT NULL
# MAGIC     AND DC.CLAIM_NUMBER LIKE 'AAS%'
# MAGIC     AND POLICY.POLICY_NUMBER LIKE 'AAMOBR%' THEN 'AAUICL'
# MAGIC     WHEN POLICY.POLICY_NUMBER IS NOT NULL
# MAGIC     AND DC.CLAIM_NUMBER LIKE 'AAS%'
# MAGIC     AND POLICY.POLICY_NUMBER NOT LIKE 'AAPMB%' THEN 'PANEL'
# MAGIC     WHEN POLICY.POLICY_NUMBER IS NOT NULL
# MAGIC     AND DC.CLAIM_NUMBER LIKE 'AAS%'
# MAGIC     AND POLICY.POLICY_NUMBER NOT LIKE 'AAMOBR%' THEN 'AAUICL'
# MAGIC     WHEN POLICY.POLICY_NUMBER IS NOT NULL
# MAGIC     AND DC.CLAIM_NUMBER LIKE 'MEM%' THEN 'MEMBER'
# MAGIC     ELSE NULL
# MAGIC   END AS Workstream,CASE
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL THEN 'NO'
# MAGIC     ELSE 'YES'
# MAGIC   END AS ENOLReport,CASE
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL THEN '2'
# MAGIC     ELSE '1'
# MAGIC   END AS ENOLOrder,
# MAGIC   IMPORTD.import_response_id,
# MAGIC   DC.tp_insurer,CASE
# MAGIC     WHEN TP_INSURER IN (
# MAGIC       'AA MEMBER',
# MAGIC       'AA UNDERWRITING',
# MAGIC       'AA UNDERWRITING NM',
# MAGIC       'AA UNDERWRITING SMART',
# MAGIC       'AA SILVER',
# MAGIC       'AA GOLD',
# MAGIC       'AA PLATINUM'
# MAGIC     ) THEN 1
# MAGIC     ELSE 0
# MAGIC   END AS AAvAA,
# MAGIC   TPCOUNT.ThirdPartCount,
# MAGIC   CONTACTTP.ContactableTP,
# MAGIC   DC.liability_decision,CASE
# MAGIC     WHEN DC.LIABILITY_DECISION = 'NONFAULT' THEN 1
# MAGIC     ELSE 0
# MAGIC   END AS NonFault,CASE
# MAGIC     WHEN DC.LIABILITY_DECISION = 'SPLIT' THEN 1
# MAGIC     ELSE 0
# MAGIC   END AS Split,CASE
# MAGIC     WHEN DC.LIABILITY_DECISION = 'FAULT' THEN 1
# MAGIC     ELSE 0
# MAGIC   END AS Fault,CASE
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL THEN IFNULL(IMPORTHANDLER.FULL_USERNAME, 'OTHER')
# MAGIC     ELSE (
# MAGIC       SELECT
# MAGIC         IFNULL(FULL_USERNAME, 'OTHER')
# MAGIC       FROM
# MAGIC         hive_metastore.ice_aas.ice_trn_claim TC
# MAGIC         INNER JOIN hive_metastore.ice_aas.ice_dim_user OPENUSER ON TC.PERFORMED_BY = OPENUSER.USER_PARTY_ID
# MAGIC       WHERE
# MAGIC         TC.CLAIM_ID = DC.CLAIM_ID
# MAGIC       ORDER BY
# MAGIC         TC.TRANSACTION_SEQ ASC
# MAGIC       LIMIT
# MAGIC         1
# MAGIC     )
# MAGIC   END AS ClaimCreatedBy,CASE
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL TEAM 1' THEN 'FNOL TEAM 1'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL TEAM 2' THEN 'FNOL TEAM 2'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL TEAM 3' THEN 'FNOL TEAM 3'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL TEAM 4' THEN 'FNOL TEAM 4'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL TEAM 5' THEN 'FNOL TEAM 5'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL TEAM 6' THEN 'FNOL TEAM 6'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL TEAM 7' THEN 'FNOL TEAM 7'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL MEM 1' THEN 'FNOL MEM 1'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL MEM 2' THEN 'FNOL MEM 2'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NULL
# MAGIC     AND TEAMDESC.TEAM_DESCRIPTION = 'FNOL MEM 3' THEN 'FNOL MEM 3'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL TEAM 1' THEN 'FNOL TEAM 1'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL TEAM 2' THEN 'FNOL TEAM 2'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL TEAM 3' THEN 'FNOL TEAM 3'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL TEAM 4' THEN 'FNOL TEAM 4'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL TEAM 5' THEN 'FNOL TEAM 5'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL TEAM 6' THEN 'FNOL TEAM 6'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL TEAM 7' THEN 'FNOL TEAM 7'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL MEM 1' THEN 'FNOL MEM 1'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL MEM 2' THEN 'FNOL MEM 2'
# MAGIC     WHEN IMPORTD.IMPORT_RESPONSE_ID IS NOT NULL
# MAGIC     AND IMPORTHANDLER.TEAM_DESCRIPTION = 'FNOL MEM 3' THEN 'FNOL MEM 3'
# MAGIC     ELSE IFNULL(
# MAGIC       (
# MAGIC         SELECT
# MAGIC           IFNULL(TEAM_DESCRIPTION, 'OTHER')
# MAGIC         FROM
# MAGIC           hive_metastore.ice_aas.ice_trn_claim TC
# MAGIC           INNER JOIN hive_metastore.ice_aas.ice_dim_user OPENUSER ON TC.PERFORMED_BY = OPENUSER.USER_PARTY_ID
# MAGIC         WHERE
# MAGIC           TC.CLAIM_ID = DC.CLAIM_ID
# MAGIC         ORDER BY
# MAGIC           TC.TRANSACTION_SEQ ASC
# MAGIC         LIMIT
# MAGIC           1
# MAGIC       ), IMPORTHANDLER.TEAM_DESCRIPTION
# MAGIC     )
# MAGIC   END AS ClaimCreatedTeam,
# MAGIC   FNOLCOMPLETED.FULL_USERNAME AS FNOL_Completed_By,
# MAGIC   FNOLCOMPLETED.TEAM_DESCRIPTION AS FNOL_Completed_By_Team,
# MAGIC   DC.notification_date,
# MAGIC   CASE
# MAGIC     WHEN DC.claim_number LIKE 'AAS%'
# MAGIC     AND HOUR(DC.notification_date) > 20
# MAGIC     AND HOUR(DC.notification_date) <= 23
# MAGIC     OR DC.claim_number LIKE 'AAS%'
# MAGIC     AND HOUR(DC.notification_date) > 0
# MAGIC     AND HOUR(DC.notification_date) <= 7
# MAGIC     OR DC.claim_number LIKE 'MEM%'
# MAGIC     AND HOUR(DC.notification_date) = 22
# MAGIC     AND MINUTE(DC.notification_date) >= 45
# MAGIC     OR DC.claim_number LIKE 'MEM%'
# MAGIC     AND HOUR(DC.notification_date) > 23
# MAGIC     OR DC.claim_number LIKE 'MEM%'
# MAGIC     AND HOUR(DC.notification_date) > 0
# MAGIC     AND HOUR(DC.notification_date) < 7
# MAGIC     OR DC.claim_number LIKE 'MEM%'
# MAGIC     AND HOUR(DC.notification_date) = 7
# MAGIC     AND MINUTE(DC.notification_date) <= 15 THEN 'YES'
# MAGIC     ELSE 'NO'
# MAGIC   END AS OOHClaim
# MAGIC
# MAGIC ,CASE WHEN DATEDIFF(DAY,DC.NOTIFICATION_DATE,GETDATE()) = 1 THEN 1 ELSE 0 END AS NotifiedYesterday
# MAGIC
# MAGIC ,CASE 
# MAGIC WHEN DATEDIFF(DAY,DC.NOTIFICATION_DATE,GETDATE()) BETWEEN 2 AND NUMBEROFDAYS THEN 1 
# MAGIC ELSE 0 END AS NotifiedWTD
# MAGIC
# MAGIC ,CASE WHEN DATEDIFF(MONTH,DC.NOTIFICATION_DATE,GETDATE()) = 0 THEN 1 ELSE 0 END AS NotifiedMTD
# MAGIC
# MAGIC ,CASE WHEN DATEDIFF(YEAR,DC.NOTIFICATION_DATE,GETDATE()) = 0 THEN 1 ELSE 0 END AS NotifiedYTD
# MAGIC
# MAGIC ,DC.incident_date
# MAGIC ,DATEDIFF(DAY,DC.INCIDENT_DATE,DC.NOTIFICATION_DATE) AS IncidenttoNotify
# MAGIC ,DC.incident_type_description
# MAGIC ,DC.incident_cause_description
# MAGIC ,DC.incident_sub_cause_description
# MAGIC ,DC.EVENT_CIRCUMSTANCES
# MAGIC ,DC.LOCATION_SEARCH_TERM
# MAGIC
# MAGIC  ,LTRIM(POLICYHOLDER.TITLE +  ' ' + POLICYHOLDER.FORENAME + ' ' + POLICYHOLDER.SURNAME) AS PHNAME
# MAGIC ,POLICYHOLDER.TITLE
# MAGIC ,POLICYHOLDER.FORENAME
# MAGIC ,POLICYHOLDER.SURNAME
# MAGIC ,POLICYHOLDER.MOBILE AS PHMobileNumber
# MAGIC ,POLICYHOLDER.POSTCODE AS PHPostCode
# MAGIC ,POLICYHOLDER.EMAIL AS Email
# MAGIC ,POLICYHOLDER.DOB
# MAGIC ,DATEDIFF(YEAR,POLICYHOLDER.DOB,current_timestamp()) AS PHAge
# MAGIC ,DOV.vehicle_type
# MAGIC ,DOV.REGISTRATIONNUMBER AS VehicleReg
# MAGIC ,DOV.VEHICLE_MAKE_DESC AS VehicleMake
# MAGIC ,DOV.VEHICLE_MODEL_DESC AS VehicleModel
# MAGIC ,DOV.YEAR_OF_MANUFACTURE AS YearOfManufacture
# MAGIC ,DOV.GTA_CATEGORY AS GTACategory
# MAGIC ,DOV.DAMAGE_NOTES AS Damage
# MAGIC ,DOV.IS_VEHICLE_DRIVEABLE
# MAGIC ,DOV.repairable
# MAGIC
# MAGIC ,CASE 
# MAGIC WHEN DOV.TOTAL_LOSS IS NULL THEN 'NO' 
# MAGIC WHEN DOV.TOTAL_LOSS ='NO' THEN 'NO'
# MAGIC WHEN DOV.TOTAL_LOSS ='YES' THEN 'YES'
# MAGIC ELSE DOV.TOTAL_LOSS END AS Total_Loss
# MAGIC
# MAGIC ,CASE 
# MAGIC WHEN DOV.CURRENT_FLAG = 'Y' AND REPAIRABLE = 'YES' AND TOTAL_LOSS = 'NO' THEN 'REPAIRABLE'
# MAGIC WHEN DOV.CURRENT_FLAG = 'Y' AND REPAIRABLE IS NULL AND TOTAL_LOSS = 'NO' THEN 'REPAIRABLE'
# MAGIC WHEN DOV.CURRENT_FLAG = 'Y' AND REPAIRABLE = 'YES' AND TOTAL_LOSS IS NULL THEN 'REPAIRABLE'
# MAGIC WHEN DOV.CURRENT_FLAG = 'Y' AND REPAIRABLE IS NULL AND TOTAL_LOSS IS NULL THEN 'REPAIRABLE'
# MAGIC
# MAGIC WHEN DOV.CURRENT_FLAG = 'Y' AND REPAIRABLE = 'NO' AND TOTAL_LOSS = 'YES' THEN 'TOTAL LOSS'
# MAGIC WHEN DOV.CURRENT_FLAG = 'Y' AND REPAIRABLE = 'NO' AND TOTAL_LOSS IS NULL THEN 'TOTAL LOSS'
# MAGIC WHEN DOV.CURRENT_FLAG = 'Y' AND REPAIRABLE IS NULL AND TOTAL_LOSS = 'YES' THEN 'TOTAL LOSS'
# MAGIC WHEN DOV.CURRENT_FLAG = 'N' THEN NULL
# MAGIC ELSE 'UNKNOWN'
# MAGIC END AS Repairable_TotalLoss
# MAGIC
# MAGIC ,CASE
# MAGIC WHEN DOV.VEHICLE_MAKE_DESC IN ('ASTON MARTIN','AUDI','BENTLEY','BMW','CADILLAC','FERRARI','INFINITI','ISUZU','JAGUAR','JEEP','LAMBORGHINI','LANDROVER','LAND ROVER','LOTUS','LEXUS','MASERATI','MERCEDES','PORSCHE','RANGE ROVER','ROLLS ROYCE','SAAB','TESLA','TVR','VOLVO') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'ALFA ROMEO' AND DOV.VEHICLE_MODEL_DESC LIKE '%147%') OR (DOV.VEHICLE_MAKE_DESC = 'ALFA ROMEO' AND DOV.VEHICLE_MODEL_DESC LIKE '%156%') OR (DOV.VEHICLE_MAKE_DESC = 'ALFA ROMEO' AND DOV.VEHICLE_MODEL_DESC LIKE '%159%') OR (DOV.VEHICLE_MAKE_DESC = 'ALFA ROMEO' AND DOV.VEHICLE_MODEL_DESC LIKE '%GIULIETTA%') OR (DOV.VEHICLE_MAKE_DESC ='ALFA ROMEO' AND DOV.VEHICLE_MODEL_DESC LIKE '%BRERA%') OR (DOV.VEHICLE_MAKE_DESC = 'ALFA ROMEO' AND DOV.VEHICLE_MODEL_DESC LIKE '%GUILIA%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'CHEVROLET' AND DOV.VEHICLE_MODEL_DESC LIKE '%CAPTIVA%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'CHRYSLER' AND DOV.VEHICLE_MODEL_DESC LIKE '%300%') OR (DOV.VEHICLE_MAKE_DESC = 'CHRYSLER' AND DOV.VEHICLE_MODEL_DESC LIKE '%CROSSFIRE%')  THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'CITROEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%C6%') OR (DOV.VEHICLE_MAKE_DESC = 'CITROEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%RACING%') OR (DOV.VEHICLE_MAKE_DESC = 'CITROEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%C-CROSSER%')  THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'FORD' AND DOV.VEHICLE_MODEL_DESC LIKE '%GT%') OR (DOV.VEHICLE_MAKE_DESC = 'FORD' AND DOV.VEHICLE_MODEL_DESC LIKE '%FOCUS ST-%') OR (DOV.VEHICLE_MAKE_DESC = 'FORD' AND DOV.VEHICLE_MODEL_DESC LIKE '%FIESTA ST-%') OR (DOV.VEHICLE_MAKE_DESC = 'FORD' AND DOV.VEHICLE_MODEL_DESC LIKE '%KUGA%') OR (DOV.VEHICLE_MAKE_DESC = 'FORD' AND DOV.VEHICLE_MODEL_DESC LIKE '%RS%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'HONDA' AND DOV.VEHICLE_MODEL_DESC LIKE '%LEGEND%') OR (DOV.VEHICLE_MAKE_DESC = 'HONDA' AND DOV.VEHICLE_MODEL_DESC LIKE '%CRV%') OR (DOV.VEHICLE_MAKE_DESC = 'HONDA' AND DOV.VEHICLE_MODEL_DESC LIKE '%CR-V%')OR (DOV.VEHICLE_MAKE_DESC = 'HONDA' AND DOV.VEHICLE_MODEL_DESC LIKE '%CIVIC S%') OR (DOV.VEHICLE_MAKE_DESC = 'HONDA' AND DOV.VEHICLE_MODEL_DESC LIKE '%TYPE R%') OR (DOV.VEHICLE_MAKE_DESC = 'HONDA' AND DOV.VEHICLE_MODEL_DESC LIKE '%S2000%')THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'HYUNDAI' AND DOV.VEHICLE_MODEL_DESC LIKE '%SANTA FE%') OR (DOV.VEHICLE_MAKE_DESC = 'HYUNDAI' AND DOV.VEHICLE_MODEL_DESC LIKE '%COUPE%') OR (DOV.VEHICLE_MAKE_DESC = 'HYUNDAI' AND DOV.VEHICLE_MODEL_DESC LIKE '%IX35%') OR (DOV.VEHICLE_MAKE_DESC = 'HYUNDAI' AND DOV.VEHICLE_MODEL_DESC LIKE '%IX 35%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'KIA' AND DOV.VEHICLE_MODEL_DESC LIKE '%SORRENTO%') OR (DOV.VEHICLE_MAKE_DESC = 'KIA' AND DOV.VEHICLE_MODEL_DESC LIKE '%SPORTAGE%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'MAZDA' AND DOV.VEHICLE_MODEL_DESC LIKE '%MX%') OR (DOV.VEHICLE_MAKE_DESC = 'KIA' AND DOV.VEHICLE_MODEL_DESC LIKE '%RX%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'MERCEDES-BENZ' AND DOV.VEHICLE_MODEL_DESC NOT LIKE '%VIANO%') OR (DOV.VEHICLE_MAKE_DESC = 'MERCEDES-BENZ' AND DOV.VEHICLE_MODEL_DESC NOT LIKE '%VITO%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'MERCEDES-BENZ' AND DOV.VEHICLE_MODEL_DESC LIKE '%SPRINTER%') OR (DOV.VEHICLE_MAKE_DESC = 'MERCEDES' AND DOV.VEHICLE_MODEL_DESC LIKE '%SPRINTER%') THEN 'NO'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'MG' AND DOV.VEHICLE_MODEL_DESC LIKE '%ZR%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'MG-MOTOR' AND DOV.VEHICLE_MODEL_DESC LIKE '%ZR%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'MINI' AND DOV.VEHICLE_MODEL_DESC LIKE '%COOPER%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'MITSUBISHI' AND DOV.VEHICLE_MODEL_DESC LIKE '%OUTLANDER%') OR (DOV.VEHICLE_MAKE_DESC = 'MITSUBISHI' AND DOV.VEHICLE_MODEL_DESC LIKE '%SHOGUN%') OR (DOV.VEHICLE_MAKE_DESC = 'MITSUBISHI' AND DOV.VEHICLE_MODEL_DESC LIKE '%WARRIOR%') OR (DOV.VEHICLE_MAKE_DESC = 'MITSUBISHI' AND DOV.VEHICLE_MODEL_DESC LIKE '%EVO%')  THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'NISSAN' AND DOV.VEHICLE_MODEL_DESC LIKE '%TERRANO%') OR (DOV.VEHICLE_MAKE_DESC = 'NISSAN' AND DOV.VEHICLE_MODEL_DESC LIKE '%X-TRAIL%') OR (DOV.VEHICLE_MAKE_DESC = 'NISSAN' AND DOV.VEHICLE_MODEL_DESC LIKE '%PATHFINDER%') OR (DOV.VEHICLE_MAKE_DESC = 'NISSAN' AND DOV.VEHICLE_MODEL_DESC LIKE '%JUKE NISMO%') OR (DOV.VEHICLE_MAKE_DESC = 'NISSAN' AND DOV.VEHICLE_MODEL_DESC LIKE '%GTR%') OR (DOV.VEHICLE_MAKE_DESC = 'NISSAN' AND DOV.VEHICLE_MODEL_DESC LIKE '%COUPE%')  THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'PEUGEOT' AND DOV.VEHICLE_MODEL_DESC LIKE '%RCZ%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'RENAULT' AND DOV.VEHICLE_MODEL_DESC LIKE '%CLIO RS%') OR (DOV.VEHICLE_MAKE_DESC = 'RENAULT' AND DOV.VEHICLE_MODEL_DESC LIKE '%CLIO SPORT%') OR (DOV.VEHICLE_MAKE_DESC = 'RENAULT' AND DOV.VEHICLE_MODEL_DESC LIKE '%MEGANE SPORT%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'ROVER' AND DOV.VEHICLE_MODEL_DESC LIKE '%MGF%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'SEAT' AND DOV.VEHICLE_MODEL_DESC LIKE '%CUPRA%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'SEAT' AND DOV.VEHICLE_MODEL_DESC LIKE '%YETI%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'SUBARU' AND DOV.VEHICLE_MODEL_DESC LIKE '%FORESTER%') OR (DOV.VEHICLE_MAKE_DESC = 'SUBARU' AND DOV.VEHICLE_MODEL_DESC LIKE '%WRX%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'SUZUKI' AND DOV.VEHICLE_MODEL_DESC LIKE '%GRAND%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'TOYOTA' AND DOV.VEHICLE_MODEL_DESC LIKE '%RAV-4%') OR (DOV.VEHICLE_MAKE_DESC = 'TOYOTA' AND DOV.VEHICLE_MODEL_DESC LIKE '%RAV4%') OR (DOV.VEHICLE_MAKE_DESC = 'TOYOTA' AND DOV.VEHICLE_MODEL_DESC LIKE '%RAV 4%') OR (DOV.VEHICLE_MAKE_DESC = 'TOYOTA' AND DOV.VEHICLE_MODEL_DESC LIKE '%LANDCRUISER%') OR (DOV.VEHICLE_MAKE_DESC = 'TOYOTA' AND DOV.VEHICLE_MODEL_DESC LIKE '%LAND CRUISER%') OR (DOV.VEHICLE_MAKE_DESC = 'TOYOTA' AND DOV.VEHICLE_MODEL_DESC LIKE '%CELICA%') OR (DOV.VEHICLE_MAKE_DESC = 'TOYOTA' AND DOV.VEHICLE_MODEL_DESC LIKE '%MR2%' )OR (DOV.VEHICLE_MAKE_DESC = 'TOYOTA' AND DOV.VEHICLE_MODEL_DESC LIKE '%GT86%')   THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'VAUXHALL' AND DOV.VEHICLE_MODEL_DESC LIKE '%VXR%') OR (DOV.VEHICLE_MAKE_DESC = 'VAUXHALL' AND DOV.VEHICLE_MODEL_DESC LIKE '%MOKKA CDTI%') THEN 'YES'
# MAGIC WHEN (DOV.VEHICLE_MAKE_DESC = 'VOLKSWAGEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%PHAETON%') OR (DOV.VEHICLE_MAKE_DESC = 'VOLKSWAGEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%TIGUAN%') OR (DOV.VEHICLE_MAKE_DESC = 'VOLKSWAGEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%TOUAREG%') OR (DOV.VEHICLE_MAKE_DESC = 'VOLKSWAGEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%POLO GTI%') OR (DOV.VEHICLE_MAKE_DESC = 'VOLKSWAGEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%SCIROCCO GT%') OR (DOV.VEHICLE_MAKE_DESC = 'VOLKSWAGEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%GOLF R%') OR (DOV.VEHICLE_MAKE_DESC = 'VOLKSWAGEN' AND DOV.VEHICLE_MODEL_DESC LIKE '%GOLF V6%') THEN 'YES'
# MAGIC WHEN DOV.VEHICLE_MAKE_DESC IN ('FIAT','REVA','MICROCAR','SMART') THEN 'NO'
# MAGIC WHEN DOV.VEHICLE_MAKE_DESC IS NULL THEN 'N/A'
# MAGIC ELSE 'NO' 
# MAGIC END AS Prestige
# MAGIC
# MAGIC ,Subrogated
# MAGIC ,CASE 
# MAGIC WHEN SUBROGATED = '1' THEN 'N/A' 
# MAGIC ELSE DC.SUBRO_REJECT_REASON 
# MAGIC END AS SUBRO_REJECT_REASON
# MAGIC
# MAGIC ,CASE WHEN FPJOB_MOTORREPAIRS_APPOINTED + FPJOB_MOTORREPAIRSNETWORK + FPJOB_MOTORREPAIRSOUTOFNETWORK + FPJOB_HIRE_TOTAL + FPJOB_MOTORREPAIRSCREDIT + FPJOB_CREDITHIRE_TOTAL > 0  THEN 1 ELSE 0 END AS Offered_Services
# MAGIC ,CASE WHEN FPJOB_MOTORREPAIRS_AGREED + FPJOB_MOTORREPAIRSNETWORKAGREED + FPJOB_MOTORREPAIRSOUTOFNETWORKAGREED + FPJOB_HIRE_AGREED + FPJOB_MOTORREPAIRSCREDIT_AGREED + FPJOB_CREDITHIRE_AGREED > 0 THEN 1 ELSE 0 END AS Accepted_Services
# MAGIC ,CASE WHEN SUBROGATED = '1' AND (FPJOB_MOTORREPAIRS_ASSIGNED + FPJOB_MOTORREPAIRS_ACCEPTED + FPJOB_MOTORREPAIRS_DEPLOYED + FPJOB_MOTORREPAIRS_ESTIMATED + FPJOB_MOTORREPAIRS_ESTIMATEAUTHORISED + FPJOB_MOTORREPAIRS_INPROGRESS + FPJOB_MOTORREPAIRS_COMPLETED > 0 ) THEN 1 ELSE 0 END AS Subro_Repairs_Accepted
# MAGIC ,CASE WHEN SUBROGATED = '1' AND (FPJOB_HIRE_ACCEPTED + FPJOB_HIRE_ASSIGNED + FPJOB_HIRE_DEPLOYED + FPJOB_HIRE_INPROGRESS + FPJOB_HIRE_COMPLETED > 0 ) THEN 1 ELSE 0 END AS Subro_Hire_Accepted
# MAGIC ,CASE WHEN SUBROGATED = '1' AND (FPJOB_MOTORREPAIRS_ASSIGNED + FPJOB_MOTORREPAIRS_ACCEPTED + FPJOB_MOTORREPAIRS_DEPLOYED + FPJOB_MOTORREPAIRS_ESTIMATED + FPJOB_MOTORREPAIRS_ESTIMATEAUTHORISED + FPJOB_MOTORREPAIRS_INPROGRESS + FPJOB_MOTORREPAIRS_COMPLETED + FPJOB_HIRE_ACCEPTED + FPJOB_HIRE_ASSIGNED + FPJOB_HIRE_DEPLOYED + FPJOB_HIRE_INPROGRESS + FPJOB_HIRE_COMPLETED > 0 ) THEN 1 ELSE 0 END AS Subro_Services_Accepted
# MAGIC ,CASE WHEN SUBROGATED = '0' AND (FPJOB_CREDITREPAIRS_ASSIGNED + FPJOB_CREDITREPAIRS_ACCEPTED + FPJOB_CREDITREPAIRS_DEPLOYED + FPJOB_CREDITREPAIRS_INPROGRESS + FPJOB_CREDITREPAIRS_ESTIMATED + FPJOB_CREDITREPAIRS_ESTIMATEAUTHORISED + FPJOB_CREDITREPAIRS_COMPLETED > 0) THEN 1 ELSE 0 END AS Credit_Repairs_Accepted
# MAGIC ,CASE WHEN (FPJOB_CREDITHIRE_ASSIGNED + FPJOB_CREDITHIRE_ACCEPTED + FPJOB_CREDITHIRE_DEPLOYED + FPJOB_CREDITHIRE_INPROGRESS + FPJOB_CREDITHIRE_COMPLETED > 0) THEN 1 ELSE 0 END AS Credit_Hire_Accepted
# MAGIC ,CASE WHEN (FPJOB_MOTORREPAIRSCREDIT + FPJOB_CREDITHIRE_TOTAL > 0) THEN 1 ELSE 0 END AS CREDIT_TOTAL
# MAGIC ,CASE WHEN FPJOB_RECOVERY_ASSIGNED + FPJOB_RECOVERY_AGREED + FPJOB_RECOVERY_ACCEPTED + FPJOB_RECOVERY_DEPLOYED + FPJOB_RECOVERY_INPROGRESS + FPJOB_RECOVERY_COMPLETE > 0 THEN 1 ELSE 0 END AS Tow_Accepted
# MAGIC ,CASE WHEN MEMBER_TOW_PREPAID_ASSIGNED + MEMBER_TOW_PREPAID_AGREED + MEMBER_TOW_PREPAID_ACCEPTED + MEMBER_TOW_PREPAID_DEPLOYED + MEMBER_TOW_PREPAID_INPROGRESS + MEMBER_TOW_PREPAID_COMPLETE > 0 THEN 1 ELSE 0 END AS PrePaid_Tow_Accepted
# MAGIC
# MAGIC ,FPJob_MotorRepairsNetwork
# MAGIC ,FPJob_MotorRepairsOutOfNetwork
# MAGIC ,FPJob_MotorRepairs_Appointed
# MAGIC ,FPJob_MotorRepairs_Assigned
# MAGIC ,FPJob_MotorRepairs_Deployed
# MAGIC ,FPJob_MotorRepairs_Accepted
# MAGIC ,FPJob_MotorRepairs_Estimated
# MAGIC ,FPJob_MotorRepairs_EstimateAuthorised
# MAGIC ,FPJob_MotorRepairs_InProgress
# MAGIC ,FPJob_MotorRepairs_Completed
# MAGIC ,FPJob_MotorRepairs_Refused
# MAGIC ,FPJob_MotorRepairs
# MAGIC ,FPJob_MotorRepairs1
# MAGIC
# MAGIC ,CASE WHEN MEMATFAULTREPAIRSNEW > 0 THEN 1 ELSE 0 END AS MemAtFaultRepairs
# MAGIC ,CASE WHEN MEMATFAULTREPAIRSAGREEDNEW > 0 THEN 1 ELSE 0 END AS MemAtFaultRepairsAgreed
# MAGIC ,CASE WHEN MEMATFAULTREPAIRSPENDINGNEW > 0 THEN 1 ELSE 0 END AS MemAtFaultRepairsPending
# MAGIC ,CASE WHEN MEMATFAULTREPAIRSACCEPTEDNEW > 0 THEN 1 ELSE 0 END AS MemAtFaultRepairsAccepted
# MAGIC ,CASE WHEN MEMATFAULTREPAIRSCOMPLETENEW > 0 THEN 1 ELSE 0 END AS MemAtFaultRepairsComplete
# MAGIC ,CASE WHEN MEMATFAULTREPAIRSREFUSEDNEW > 0 THEN 1 ELSE 0 END AS MemAtFaultRepairsRefused
# MAGIC
# MAGIC ,E2E_Appointed
# MAGIC ,E2E_Assigned
# MAGIC ,E2E_Deployed
# MAGIC ,E2E_Accepted
# MAGIC ,E2E_In_Progress
# MAGIC ,E2E_Complete
# MAGIC ,E2E_Refused
# MAGIC ,E2E_Cancelled
# MAGIC
# MAGIC ,FPJob_Hire_Assigned
# MAGIC ,FPJob_Hire_Deployed
# MAGIC ,FPJob_Hire_Accepted
# MAGIC ,FPJob_Hire_InProgress
# MAGIC ,FPJob_Hire_Completed
# MAGIC ,FPJob_Hire_Refused
# MAGIC ,FPJob_Hire_Cancelled
# MAGIC ,FPJob_Hire_Total
# MAGIC
# MAGIC ,FPJob_MotorRepairsCredit
# MAGIC ,FPJob_CreditRepairs_Assigned
# MAGIC ,FPJob_CreditRepairs_Deployed
# MAGIC ,FPJob_CreditRepairs_Accepted
# MAGIC ,FPJob_CreditRepairs_InProgress
# MAGIC ,FPJob_CreditRepairs_Estimated
# MAGIC ,FPJob_CreditRepairs_EstimateAuthorised
# MAGIC ,FPJob_CreditRepairs_Refused
# MAGIC ,FPJob_CreditRepairs_Completed
# MAGIC
# MAGIC ,FPJob_CreditHire_Total
# MAGIC ,FPJob_CreditHire_Assigned
# MAGIC ,FPJob_CreditHire_Deployed
# MAGIC ,FPJob_CreditHire_Accepted
# MAGIC ,FPJob_CreditHire_Inprogress
# MAGIC ,FPJob_CreditHire_Completed
# MAGIC ,FPJob_CreditHire_Repudiated
# MAGIC ,FPJob_CreditHire_Refused
# MAGIC ,FPJob_CreditHire_Cancelled
# MAGIC
# MAGIC ,FPJob_Hire_AX_Total
# MAGIC ,FPJob_Hire_AX_Assigned
# MAGIC ,FPJob_Hire_AX_Accepted
# MAGIC ,FPJob_Hire_AX_Refused
# MAGIC ,FPJob_Hire_AX_Completed
# MAGIC ,FPJob_Hire_AX_Cancelled
# MAGIC
# MAGIC ,FPJob_CreditHire_AX_Total
# MAGIC ,FPJob_CreditHire_AX_Assigned
# MAGIC ,FPJob_CreditHire_AX_Accepted
# MAGIC ,FPJob_CreditHire_AX_Refused
# MAGIC ,FPJob_CreditHire_AX_Completed
# MAGIC ,FPJob_CreditHire_AX_Cancelled
# MAGIC
# MAGIC ,FPJob_Hire_Kindertons_Total
# MAGIC ,FPJob_Hire_Kindertons_Assigned
# MAGIC ,FPJob_Hire_Kindertons_Accepted
# MAGIC ,FPJob_Hire_Kindertons_Refused
# MAGIC ,FPJob_Hire_Kindertons_Completed
# MAGIC ,FPJob_Hire_Kindertons_Cancelled
# MAGIC
# MAGIC ,FPJob_CreditHire_Kindertons_Total
# MAGIC ,FPJob_CreditHire_Kindertons_Assigned
# MAGIC ,FPJob_CreditHire_Kindertons_Accepted
# MAGIC ,FPJob_CreditHire_Kindertons_Refused
# MAGIC ,FPJob_CreditHire_Kindertons_Completed
# MAGIC ,FPJob_CreditHire_Kindertons_Cancelled
# MAGIC
# MAGIC ,FPJob_Hire_Hertz_Total
# MAGIC ,FPJob_Hire_Hertz_Assigned
# MAGIC ,FPJob_Hire_Hertz_Accepted
# MAGIC ,FPJob_Hire_Hertz_Refused
# MAGIC ,FPJob_Hire_Hertz_Completed
# MAGIC ,FPJob_Hire_Hertz_Cancelled
# MAGIC
# MAGIC ,FPJob_CreditHire_Hertz_Total
# MAGIC ,FPJob_CreditHire_Hertz_Assigned
# MAGIC ,FPJob_CreditHire_Hertz_Accepted
# MAGIC ,FPJob_CreditHire_Hertz_Refused
# MAGIC ,FPJob_CreditHire_Hertz_Completed
# MAGIC ,FPJob_CreditHire_Hertz_Cancelled
# MAGIC
# MAGIC ,FPJob_Hire_Europcar_Total
# MAGIC ,FPJob_Hire_Europcar_Assigned
# MAGIC ,FPJob_Hire_Europcar_Accepted
# MAGIC ,FPJob_Hire_Europcar_Refused
# MAGIC ,FPJob_Hire_Europcar_Completed
# MAGIC ,FPJob_Hire_Europcar_Cancelled
# MAGIC
# MAGIC ,FPJob_CreditHire_Europcar_Total
# MAGIC ,FPJob_CreditHire_Europcar_Assigned
# MAGIC ,FPJob_CreditHire_Europcar_Accepted
# MAGIC ,FPJob_CreditHire_Europcar_Refused
# MAGIC ,FPJob_CreditHire_Europcar_Completed
# MAGIC ,FPJob_CreditHire_Europcar_Cancelled
# MAGIC
# MAGIC ,FPJob_Hire_Chief_Total
# MAGIC ,FPJob_Hire_Chief_Assigned
# MAGIC ,FPJob_Hire_Chief_Accepted
# MAGIC ,FPJob_Hire_Chief_Refused
# MAGIC ,FPJob_Hire_Chief_Completed
# MAGIC ,FPJob_Hire_Chief_Cancelled
# MAGIC
# MAGIC ,FPJob_CreditHire_Chief_Total
# MAGIC ,FPJob_CreditHire_Chief_Assigned
# MAGIC ,FPJob_CreditHire_Chief_Accepted
# MAGIC ,FPJob_CreditHire_Chief_Refused
# MAGIC ,FPJob_CreditHire_Chief_Completed
# MAGIC ,FPJob_CreditHire_Chief_Cancelled
# MAGIC
# MAGIC ,FPJob_Tow_Offered_All
# MAGIC ,FPJob_Tow_Agreed_All
# MAGIC ,FPJob_Tow_Assigned_All
# MAGIC ,FPJob_Tow_Deployed_All
# MAGIC ,FPJob_Tow_Accepted_All
# MAGIC ,FPJob_Tow_InProgress_All
# MAGIC ,FPJob_Tow_Complete_All
# MAGIC ,FPJob_Tow_Refused_All
# MAGIC ,FPJob_Tow_Cancelled_All
# MAGIC ,FPJob_Tow_Declined_All
# MAGIC
# MAGIC ,FPJob_Recovery_Offered
# MAGIC ,FPJob_Recovery_Agreed
# MAGIC ,FPJob_Recovery_Assigned
# MAGIC ,FPJob_Recovery_Deployed
# MAGIC ,FPJob_Recovery_Accepted
# MAGIC ,FPJob_Recovery_InProgress
# MAGIC ,FPJob_Recovery_Complete
# MAGIC ,FPJob_Recovery_Refused
# MAGIC ,FPJob_Recovery_Cancelled
# MAGIC ,FPJob_Recovery_Declined
# MAGIC
# MAGIC ,FPJob_Recovery_OfferedAANVA
# MAGIC ,FPJob_Recovery_AgreedAANVA
# MAGIC ,FPJob_Recovery_AssignedAANVA
# MAGIC ,FPJob_Recovery_DeployedAANVA
# MAGIC ,FPJob_Recovery_AcceptedAANVA
# MAGIC ,FPJob_Recovery_InProgressAANVA
# MAGIC ,FPJob_Recovery_CompleteAANVA
# MAGIC ,FPJob_Recovery_RefusedAANVA
# MAGIC ,FPJob_Recovery_CancelledAANVA
# MAGIC ,FPJob_Recovery_DeclinedAANVA
# MAGIC
# MAGIC ,FPJob_Recovery_OfferedAA
# MAGIC ,FPJob_Recovery_AgreedAA
# MAGIC ,FPJob_Recovery_AssignedAA
# MAGIC ,FPJob_Recovery_DeployedAA
# MAGIC ,FPJob_Recovery_AcceptedAA
# MAGIC ,FPJob_Recovery_InProgressAA
# MAGIC ,FPJob_Recovery_CompleteAA
# MAGIC ,FPJob_Recovery_RefusedAA
# MAGIC ,FPJob_Recovery_CancelledAA
# MAGIC ,FPJob_Recovery_DeclinedAA
# MAGIC
# MAGIC ,FPJob_Recovery_OfferedNationwide
# MAGIC ,FPJob_Recovery_AgreedNationwide
# MAGIC ,FPJob_Recovery_AssignedNationwide
# MAGIC ,FPJob_Recovery_DeployedNationwide
# MAGIC ,FPJob_Recovery_AcceptedNationwide
# MAGIC ,FPJob_Recovery_InProgressNationwide
# MAGIC ,FPJob_Recovery_CompleteNationwide
# MAGIC ,FPJob_Recovery_RefusedNationwide
# MAGIC ,FPJob_Recovery_CancelledNationwide
# MAGIC ,FPJob_Recovery_DeclinedNationwide
# MAGIC
# MAGIC ,FPJob_Recovery_OfferedNatwest
# MAGIC ,FPJob_Recovery_AgreedNatwest
# MAGIC ,FPJob_Recovery_AssignedNatwest
# MAGIC ,FPJob_Recovery_DeployedNatwest
# MAGIC ,FPJob_Recovery_AcceptedNatwest
# MAGIC ,FPJob_Recovery_InProgressNatwest
# MAGIC ,FPJob_Recovery_CompleteNatwest
# MAGIC ,FPJob_Recovery_RefusedNatwest
# MAGIC ,FPJob_Recovery_CancelledNatwest
# MAGIC ,FPJob_Recovery_DeclinedNatwest
# MAGIC
# MAGIC ,CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND MEMATFAULTREPAIRSNEW >=1 AND FPJOB_RECOVERY_OFFERED >=1  THEN 1 ELSE 0 END AS AtFaultOM
# MAGIC ,CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND MEMBER_TOW_PREPAID_OFFERED > 0 THEN 1 ELSE 0 END AS PrePaidOM
# MAGIC ,CASE WHEN DC.SUBROGATED = '1' AND FPJOB_RECOVERY_OFFERED >= '1' AND MEMBER_TOW_PREPAID_OFFERED = 0 THEN 1 ELSE 0 END AS ATETowOM
# MAGIC ,CASE WHEN DC.SUBROGATED = '0' AND FPJOB_RECOVERY_OFFERED >= '1' AND MEMATFAULTREPAIRSNEW = 0  THEN 1 ELSE 0 END AS FreeTowOM
# MAGIC
# MAGIC ,CASE 
# MAGIC WHEN (DC.CLAIM_NUMBER LIKE 'MEM%' AND MEMATFAULTREPAIRSNEW >=1 AND FPJOB_RECOVERY_OFFERED >=1) OR
# MAGIC (DC.CLAIM_NUMBER LIKE 'MEM%' AND MEMBER_TOW_PREPAID_OFFERED > 0) OR
# MAGIC (DC.SUBROGATED = '1' AND FPJOB_RECOVERY_OFFERED >= '1' AND MEMBER_TOW_PREPAID_OFFERED = 0) OR
# MAGIC (DC.SUBROGATED = '0' AND FPJOB_RECOVERY_OFFERED >= '1' AND MEMATFAULTREPAIRSNEW = 0) THEN 1 
# MAGIC ELSE 0 
# MAGIC END AS AllTowOM
# MAGIC
# MAGIC ,CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND MEMATFAULTREPAIRSAGREEDNEW >=1 AND FPJOB_RECOVERY_AGREED >=1  THEN 1 ELSE 0 END AS AtFaultTowACPT
# MAGIC ,CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND MEMBER_TOW_PREPAID_AGREED > 0 THEN 1 ELSE 0 END AS PrePaidTowACPT
# MAGIC ,CASE WHEN DC.SUBROGATED = '1' AND FPJOB_RECOVERY_AGREED >= '1' AND MEMBER_TOW_PREPAID_AGREED =0 THEN 1 ELSE 0 END AS ATETowACPT
# MAGIC ,CASE WHEN DC.SUBROGATED = '0' AND FPJOB_RECOVERY_AGREED >= '1' AND MEMATFAULTREPAIRSAGREEDNEW= 0 THEN 1 ELSE 0 END AS FreeTowACPT
# MAGIC ,CASE WHEN (DC.CLAIM_NUMBER LIKE 'MEM%' AND MEMATFAULTREPAIRSAGREEDNEW >=1 AND FPJOB_RECOVERY_AGREED >=1) OR 
# MAGIC (DC.CLAIM_NUMBER LIKE 'MEM%' AND MEMBER_TOW_PREPAID_AGREED > 0) OR
# MAGIC (DC.SUBROGATED = '1' AND FPJOB_RECOVERY_AGREED  >= '1' AND MEMBER_TOW_PREPAID_AGREED  = 0) OR
# MAGIC (DC.SUBROGATED = '0' AND FPJOB_RECOVERY_AGREED  >= '1' AND MEMATFAULTREPAIRSAGREEDNEW = 0) THEN 1 
# MAGIC ELSE 0 
# MAGIC END AS AllTowACPT
# MAGIC
# MAGIC ,CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DC.SUBROGATED = '1' AND FPJOB_RECOVERY_AGREED = '1' THEN 1 ELSE 0 END AS Member_ATE_Recovery
# MAGIC
# MAGIC ,Member_Tow_PrePaid_Offered
# MAGIC ,Member_Tow_PrePaid_Agreed
# MAGIC ,Member_Tow_PrePaid_Assigned
# MAGIC ,Member_Tow_PrePaid_Deployed
# MAGIC ,Member_Tow_PrePaid_Accepted
# MAGIC ,Member_Tow_PrePaid_InProgress
# MAGIC ,Member_Tow_PrePaid_Complete
# MAGIC ,Member_Tow_PrePaid_Refused 
# MAGIC ,Member_Tow_PrePaid_Cancelled
# MAGIC ,Member_Tow_PrePaid_Declined
# MAGIC
# MAGIC ,CASE 
# MAGIC WHEN MEMBER_TOW_PREPAID_OFFERED + FPJOB_RECOVERY_OFFERED >0 THEN 'Y'
# MAGIC ELSE 'N'
# MAGIC END AS TowServiceonClaim
# MAGIC
# MAGIC ,CASE WHEN MEMBER_TOW_PREPAID_AGREED + FPJOB_RECOVERY_AGREED >0 THEN 1
# MAGIC ELSE 0
# MAGIC END AS TowServiceAgreed
# MAGIC
# MAGIC ,FPJob_Solicitor_Assigned
# MAGIC ,FPJob_Solicitor_Deployed
# MAGIC ,FPJob_Solicitor_Accepted
# MAGIC ,FPJob_Solicitor_Completed
# MAGIC ,FPJob_Solicitor_Refused
# MAGIC
# MAGIC ,Injury_MWH_Assigned
# MAGIC ,Injury_MWH_Deployed
# MAGIC ,Injury_MWH_Accepted
# MAGIC ,Injury_MWH_Refused
# MAGIC ,Injury_MWH_Completed
# MAGIC
# MAGIC ,Injury_BC_Assigned
# MAGIC ,Injury_BC_Deployed
# MAGIC ,Injury_BC_Accepted
# MAGIC ,Injury_BC_Refused
# MAGIC ,Injury_BC_Completed
# MAGIC
# MAGIC ,Injury_ML_Assigned
# MAGIC ,Injury_ML_Deployed
# MAGIC ,Injury_ML_Accepted
# MAGIC ,Injury_ML_Refused
# MAGIC ,Injury_ML_Completed
# MAGIC
# MAGIC ,Injury_IM_Assigned
# MAGIC ,Injury_IM_Deployed
# MAGIC ,Injury_IM_Accepted
# MAGIC ,Injury_IM_Refused
# MAGIC ,Injury_IM_Completed
# MAGIC
# MAGIC ,Injury_SG_Assigned
# MAGIC ,Injury_SG_Deployed
# MAGIC ,Injury_SG_Accepted
# MAGIC ,Injury_SG_Refused
# MAGIC ,Injury_SG_Completed
# MAGIC
# MAGIC ,Injury_ORS_Assigned
# MAGIC ,Injury_ORS_Deployed
# MAGIC ,Injury_ORS_Accepted
# MAGIC ,Injury_ORS_Refused
# MAGIC ,Injury_ORS_Completed
# MAGIC
# MAGIC ,FPJob_RecoveryManager_Deployed
# MAGIC ,FPJob_RecoveryManager_Accepted 
# MAGIC ,FPJob_RecoveryManager_Completed  
# MAGIC ,FPJob_RecoveryManager_Refused
# MAGIC
# MAGIC ,RepairReserves
# MAGIC ,TotalLossReserves
# MAGIC ,RecoveredVehicleReserves
# MAGIC ,HireCarReserves
# MAGIC ,SalvageReserves
# MAGIC ,WindscreenReserves
# MAGIC ,OtherADReserves
# MAGIC ,RepairRecoveryReserves
# MAGIC ,TotalLossRecoveryReserves
# MAGIC ,RecoveredVehicleRecoveryReserves
# MAGIC ,HireCarRecoveryReserves
# MAGIC ,SalvageRecoveryReserves
# MAGIC ,WindscreenRecoveryReserves
# MAGIC ,OtherADRecoveryReserves
# MAGIC
# MAGIC ,Payments
# MAGIC ,RepairPaymentsRequested
# MAGIC ,TotalLossPaymentsRequested
# MAGIC ,RecoveredVehiclePaymentsRequested
# MAGIC ,HireCarPaymentsRequested
# MAGIC ,SalvagePaymentsRequested
# MAGIC ,WindscreenPaymentsRequested
# MAGIC ,OtherADPaymentsRequested
# MAGIC ,RepairPaymentsApproved
# MAGIC ,TotalLossPaymentsApproved
# MAGIC ,RecoveredVehiclePaymentsApproved
# MAGIC ,HireCarPaymentsApproved
# MAGIC ,SalvagePaymentsApproved
# MAGIC ,WindscreenPaymentsApproved
# MAGIC ,OtherADPaymentsApproved
# MAGIC
# MAGIC ,((IFNULL(ADRESERVES.REPAIRRESERVES,0) + IFNULL(ADPAYMENTS.REPAIRPAYMENTSAPPROVED,0)) - (IFNULL(ADRESERVES.REPAIRRECOVERYRESERVES,0) + IFNULL(ADRECOVERY.REPAIRPAYMENTSRECOVERED,0))) - (IFNULL(ADPAYMENTS.REPAIRPAYMENTSAPPROVED,0) - IFNULL(ADRECOVERY.REPAIRPAYMENTSRECOVERED,0)) AS AnticipatedRepairProfit
# MAGIC ,-(IFNULL(ADPAYMENTS.REPAIRPAYMENTSAPPROVED,0) - IFNULL(ADRECOVERY.REPAIRPAYMENTSRECOVERED,0)) AS ActualRepairProfit
# MAGIC ,((IFNULL(ADRESERVES.RECOVEREDVEHICLERESERVES,0) + IFNULL(ADPAYMENTS.RECOVEREDVEHICLEPAYMENTSAPPROVED,0)) - (IFNULL(ADRESERVES.RECOVEREDVEHICLERECOVERYRESERVES,0) + IFNULL(ADRECOVERY.RECOVEREDVEHICLEPAYMENTSRECOVERED,0))) - (IFNULL(ADPAYMENTS.RECOVEREDVEHICLEPAYMENTSAPPROVED,0) - IFNULL(ADRECOVERY.RECOVEREDVEHICLEPAYMENTSRECOVERED,0)) AS AnticipatedRecoveredVehicleProfit
# MAGIC ,-(IFNULL(ADPAYMENTS.RECOVEREDVEHICLEPAYMENTSAPPROVED,0) - IFNULL(ADRECOVERY.RECOVEREDVEHICLEPAYMENTSRECOVERED,0)) AS ActualRecoveredVehicleProfit
# MAGIC ,((IFNULL(ADRESERVES.HIRECARRESERVES,0) + IFNULL(ADPAYMENTS.HIRECARPAYMENTSAPPROVED,0)) - (IFNULL(ADRESERVES.HIRECARRECOVERYRESERVES,0) + IFNULL(ADRECOVERY.HIRECARPAYMENTSRECOVERED,0))) - (IFNULL(ADPAYMENTS.HIRECARPAYMENTSAPPROVED,0) - IFNULL(ADRECOVERY.HIRECARPAYMENTSRECOVERED,0)) AS AnticipatedHireCarProfit
# MAGIC ,-(IFNULL(ADPAYMENTS.HIRECARPAYMENTSAPPROVED,0) - IFNULL(ADRECOVERY.HIRECARPAYMENTSRECOVERED,0)) AS ActualHireCarProfit,
# MAGIC TC.FIRST_CLOSED_DATE
# MAGIC
# MAGIC
# MAGIC FROM
# MAGIC   hive_metastore.ice_aas.ice_dim_claim DC
# MAGIC   LEFT JOIN hive_metastore.ice_aas.ice_trn_claim TC ON TC.CLAIM_ID = DC.CLAIM_ID
# MAGIC   AND TC.CURRENT_FLAG = 'Y'
# MAGIC   LEFT JOIN hive_metastore.ice_aas.ice_dim_policy POLICY ON TC.POLICY_ID = POLICY.POLICY_ID
# MAGIC   AND POLICY.POLICY_SNAPSHOT_ID = TC.POLICY_SNAPSHOT_ID
# MAGIC   AND POLICY.CURRENT_FLAG = 'Y'
# MAGIC   LEFT JOIN hive_metastore.ice_aas.ice_dim_claim_party POLICYHOLDER ON TC.POLICYHOLDER_PARTY_ID = POLICYHOLDER.PARTY_ID
# MAGIC   AND POLICYHOLDER.CURRENT_FLAG = 'Y'
# MAGIC   LEFT JOIN hive_metastore.ice_aas.ice_trn_claim_party TRANPOLICYHOLDER ON TRANPOLICYHOLDER.CLAIM_PARTY_ID = POLICYHOLDER.PARTY_ID
# MAGIC   AND TRANPOLICYHOLDER.CURRENT_FLAG = 'Y'
# MAGIC   AND VEHICLE_ID IS NOT NULL
# MAGIC   LEFT JOIN hive_metastore.ice_aas.ice_trn_claim_party TCP ON DC.CLAIM_ID = TCP.CLAIM_ID
# MAGIC   AND TCP.CURRENT_FLAG = 'Y'
# MAGIC   AND TCP.NATURE = 'INSURER'
# MAGIC   LEFT JOIN hive_metastore.ice_aas.ice_dim_claim_party DCP ON TCP.CLAIM_PARTY_ID = DCP.PARTY_ID
# MAGIC   AND DCP.CURRENT_FLAG = 'Y'
# MAGIC   LEFT JOIN (
# MAGIC     SELECT
# MAGIC       DISTINCT DCLAIM.CLAIM_NUMBER,
# MAGIC       DTASK.TASK_NAME
# MAGIC     FROM
# MAGIC       hive_metastore.ice_aas.ice_trn_task TTASK
# MAGIC       INNER JOIN hive_metastore.ice_aas.ice_dim_task DTASK ON TTASK.TASK_KEY = DTASK.TASK_KEY
# MAGIC       AND TASK_NAME IN ('MOJ FNOL INCOMPLETE', 'FNOL INCOMPLETE')
# MAGIC       LEFT JOIN hive_metastore.ice_aas.ice_dim_claim DCLAIM ON DCLAIM.CLAIM_ID = TTASK.CLAIM_ID
# MAGIC       AND DCLAIM.CURRENT_FLAG = 'Y'
# MAGIC     WHERE
# MAGIC       TTASK.CURRENT_FLAG = 'Y'
# MAGIC       AND COMPLETED_DATE_KEY = 0
# MAGIC   ) FNOLINCOMPLETE ON DC.CLAIM_NUMBER = FNOLINCOMPLETE.CLAIM_NUMBER
# MAGIC   LEFT JOIN (
# MAGIC     SELECT
# MAGIC       IMPORTD.CLAIM_ID,
# MAGIC       IMPORT_RESPONSE_ID,
# MAGIC       IMPORT_DATE,
# MAGIC       IMPORTD.STATUS,
# MAGIC       CLAIM_XML_IMPORTER_NAME
# MAGIC     FROM
# MAGIC       hive_metastore.ice_aas.ice_trn_import_response IMPORTD
# MAGIC       LEFT JOIN hive_metastore.ice_aas.ice_trn_task TT ON TT.CLAIM_ID = IMPORTD.CLAIM_ID
# MAGIC       AND TT.CURRENT_FLAG = 'Y'
# MAGIC       AND TT.TASK_TRANSACTION_TYPE_CODE = 'COMPLETED'
# MAGIC       LEFT JOIN hive_metastore.ice_aas.ice_dim_user DU ON DU.USER_PARTY_ID = TT.USER_PARTY_ID
# MAGIC       LEFT JOIN hive_metastore.ice_aas.ice_dim_claim DC ON DC.CLAIM_ID = IMPORTD.CLAIM_ID
# MAGIC       AND DC.CURRENT_FLAG = 'Y'
# MAGIC     WHERE
# MAGIC       IMPORTD.CURRENT_FLAG = 'Y'
# MAGIC       AND CLAIM_XML_IMPORTER_NAME = 'CLAIMNOTIFICATIONIMPORTER'
# MAGIC       AND IMPORTD.STATUS = 'COMPLETE'
# MAGIC   ) IMPORTD ON IMPORTD.CLAIM_ID = DC.CLAIM_ID
# MAGIC   LEFT JOIN (
# MAGIC     SELECT
# MAGIC       CLAIM_ID,
# MAGIC       COUNT(PARTY_ID) AS THIRDPARTCOUNT
# MAGIC     FROM
# MAGIC       hive_metastore.ice_aas.ice_trn_claim_party TCP
# MAGIC       LEFT JOIN hive_metastore.ice_aas.ice_dim_claim_party DCP ON TCP.CLAIM_PARTY_ID = DCP.PARTY_ID
# MAGIC       AND DCP.CURRENT_FLAG = 'Y'
# MAGIC     WHERE
# MAGIC       TCP.CURRENT_FLAG = 'Y'
# MAGIC       AND TCP.NATURE = 'THIRD_PARTY'
# MAGIC     GROUP BY
# MAGIC       CLAIM_ID
# MAGIC   ) TPCOUNT ON DC.CLAIM_ID = TPCOUNT.CLAIM_ID
# MAGIC   LEFT JOIN (
# MAGIC     SELECT
# MAGIC       CLAIM_ID,
# MAGIC       COUNT(PARTY_ID) AS CONTACTABLETP
# MAGIC     FROM
# MAGIC       hive_metastore.ice_aas.ice_trn_claim_party TCP
# MAGIC       LEFT JOIN hive_metastore.ice_aas.ice_dim_claim_party DCP ON TCP.CLAIM_PARTY_ID = DCP.PARTY_ID
# MAGIC       AND DCP.CURRENT_FLAG = 'Y'
# MAGIC     WHERE
# MAGIC       DCP.TP_ROLE_DESCRIPTION IN (
# MAGIC         'THIRD PARTY VEHICLE DRIVER',
# MAGIC         'THIRD PARTY VEHICLE OWNER'
# MAGIC       )
# MAGIC       AND MOBILE IS NOT NULL
# MAGIC       OR DCP.TP_ROLE_DESCRIPTION IN (
# MAGIC         'THIRD PARTY VEHICLE DRIVER',
# MAGIC         'THIRD PARTY VEHICLE OWNER'
# MAGIC       )
# MAGIC       AND DAYTIME_PHONE IS NOT NULL
# MAGIC       OR DCP.TP_ROLE_DESCRIPTION IN (
# MAGIC         'THIRD PARTY VEHICLE DRIVER',
# MAGIC         'THIRD PARTY VEHICLE OWNER'
# MAGIC       )
# MAGIC       AND EVENING_PHONE IS NOT NULL
# MAGIC     GROUP BY
# MAGIC       CLAIM_ID
# MAGIC   ) CONTACTTP ON DC.CLAIM_ID = CONTACTTP.CLAIM_ID
# MAGIC   LEFT JOIN (
# MAGIC     SELECT
# MAGIC       IMPORTD.CLAIM_ID,
# MAGIC       DU.FULL_USERNAME,
# MAGIC       DU.TEAM_DESCRIPTION
# MAGIC     FROM
# MAGIC       hive_metastore.ice_aas.ice_trn_import_response IMPORTD
# MAGIC       LEFT JOIN hive_metastore.ice_aas.ice_trn_task TT ON TT.CLAIM_ID = IMPORTD.CLAIM_ID
# MAGIC       AND TT.CURRENT_FLAG = 'Y'
# MAGIC       AND TT.TASK_TRANSACTION_TYPE_CODE = 'COMPLETED'
# MAGIC       INNER JOIN hive_metastore.ice_aas.ice_dim_task DT ON DT.TASK_ID = TT.TASK_ID
# MAGIC       AND TASK_NAME LIKE '%ENOL%'
# MAGIC       AND DT.CURRENT_FLAG = 'Y'
# MAGIC       LEFT JOIN hive_metastore.ice_aas.ice_dim_user DU ON DU.USER_PARTY_ID = TT.USER_PARTY_ID
# MAGIC       LEFT JOIN hive_metastore.ice_aas.ice_dim_claim DC ON DC.CLAIM_ID = IMPORTD.CLAIM_ID
# MAGIC       AND DC.CURRENT_FLAG = 'Y'
# MAGIC     WHERE
# MAGIC       IMPORTD.CURRENT_FLAG = 'Y'
# MAGIC       AND CLAIM_XML_IMPORTER_NAME = 'CLAIMNOTIFICATIONIMPORTER'
# MAGIC       AND IMPORTD.STATUS = 'COMPLETE'
# MAGIC   ) IMPORTHANDLER ON IMPORTHANDLER.CLAIM_ID = DC.CLAIM_ID
# MAGIC   LEFT JOIN (
# MAGIC     SELECT
# MAGIC       *
# MAGIC     FROM
# MAGIC       (
# MAGIC         SELECT
# MAGIC           TC.CLAIM_ID,
# MAGIC           OPENUSER.TEAM_DESCRIPTION,
# MAGIC           ROW_NUMBER() OVER (
# MAGIC             PARTITION BY TC.CLAIM_ID
# MAGIC             ORDER BY
# MAGIC               TC.TRANSACTION_SEQ ASC
# MAGIC           ) AS RN
# MAGIC         FROM
# MAGIC           hive_metastore.ice_aas.ice_trn_claim TC
# MAGIC           INNER JOIN hive_metastore.ice_aas.ice_dim_user OPENUSER ON TC.PERFORMED_BY = OPENUSER.USER_PARTY_ID
# MAGIC       ) MAIN
# MAGIC     WHERE
# MAGIC       RN = 1
# MAGIC   ) TEAMDESC ON TEAMDESC.CLAIM_ID = DC.CLAIM_ID
# MAGIC   LEFT JOIN (
# MAGIC     SELECT
# MAGIC       *
# MAGIC     FROM
# MAGIC       (
# MAGIC         SELECT
# MAGIC           TCH.CLAIM_ID,
# MAGIC           DCLAIM.CLAIM_NUMBER,
# MAGIC           DU.FULL_USERNAME,
# MAGIC           DU.TEAM_DESCRIPTION,
# MAGIC           ROW_NUMBER() OVER (
# MAGIC             PARTITION BY TCH.CLAIM_ID
# MAGIC             ORDER BY
# MAGIC               END_TIME ASC
# MAGIC           ) AS RN
# MAGIC         FROM
# MAGIC           hive_metastore.ice_aas.ice_trn_claim_handling TCH
# MAGIC           INNER JOIN hive_metastore.ice_aas.ice_dim_user DU ON DU.USER_PARTY_ID = TCH.USER_PARTY_ID
# MAGIC           INNER JOIN hive_metastore.ice_aas.ice_dim_claim DCLAIM ON DCLAIM.CLAIM_ID = TCH.CLAIM_ID
# MAGIC           AND DCLAIM.CURRENT_FLAG = 'Y'
# MAGIC         WHERE
# MAGIC           FNOL_COMPLETE = 1
# MAGIC       ) MAIN
# MAGIC     WHERE
# MAGIC       RN = 1
# MAGIC   ) FNOLCOMPLETED ON FNOLCOMPLETED.CLAIM_NUMBER = DC.CLAIM_NUMBER
# MAGIC
# MAGIC   LEFT JOIN
# MAGIC (
# MAGIC SELECT
# MAGIC CLAIM_ID,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN REGISTRATIONNUMBER END) AS REGISTRATIONNUMBER,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN VEHICLE_TYPE END) AS VEHICLE_TYPE,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN VEHICLE_MAKE_DESC END) AS VEHICLE_MAKE_DESC,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN VEHICLE_MODEL_DESC END) AS VEHICLE_MODEL_DESC,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN YEAR_OF_MANUFACTURE END) AS YEAR_OF_MANUFACTURE,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN GTA_CATEGORY END) AS GTA_CATEGORY,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN DAMAGE_NOTES END) AS DAMAGE_NOTES,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN IS_VEHICLE_DRIVEABLE END) AS IS_VEHICLE_DRIVEABLE,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN REPAIRABLE END) AS REPAIRABLE,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN TOTAL_LOSS END) AS TOTAL_LOSS,
# MAGIC MAX(CASE WHEN ROWNUM = 1 THEN CURRENT_FLAG END) AS CURRENT_FLAG
# MAGIC FROM 
# MAGIC (
# MAGIC SELECT
# MAGIC CLAIM_ID,
# MAGIC DOV.VEHICLE_ID,
# MAGIC REGISTRATIONNUMBER,
# MAGIC VEHICLE_TYPE,
# MAGIC VEHICLE_MAKE_DESC,
# MAGIC VEHICLE_MODEL_DESC ,
# MAGIC YEAR_OF_MANUFACTURE,
# MAGIC GTA_CATEGORY,
# MAGIC DAMAGE_NOTES,
# MAGIC IS_VEHICLE_DRIVEABLE,
# MAGIC REPAIRABLE,
# MAGIC TOTAL_LOSS,
# MAGIC DOV.CURRENT_FLAG,
# MAGIC ROW_NUMBER () OVER (PARTITION BY CLAIM_ID ORDER BY DOV.VEHICLE_ID DESC) ROWNUM
# MAGIC
# MAGIC FROM  hive_metastore.ice_aas.ice_trn_claim_party TCP
# MAGIC INNER JOIN hive_metastore.ice_aas.ice_dim_object_vehicle DOV ON TCP.VEHICLE_ID = DOV.VEHICLE_ID AND DOV.CURRENT_FLAG = 'Y'
# MAGIC
# MAGIC WHERE NATURE <> 'THIRD_PARTY'
# MAGIC ) A
# MAGIC GROUP BY CLAIM_ID
# MAGIC )DOV ON DC.CLAIM_ID = DOV.CLAIM_ID
# MAGIC
# MAGIC
# MAGIC LEFT JOIN 
# MAGIC (
# MAGIC SELECT 
# MAGIC TJC.CLAIM_ID, 
# MAGIC   
# MAGIC --REPAIRS
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND IFNULL(TRACKN_ONLY_DESCRIPTION,'NO') = 'NO' THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS1,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND IFNULL(TRACKN_ONLY_DESCRIPTION,'NO') = 'NO' AND NETWORK_APPROVED = 'YES' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')  THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRSNETWORK,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND IFNULL(TRACKN_ONLY_DESCRIPTION,'NO') = 'NO' AND NETWORK_APPROVED = 'YES' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED')  THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRSNETWORKAGREED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND IFNULL(TRACKN_ONLY_DESCRIPTION,'NO') = 'NO' AND NETWORK_APPROVED = 'NO' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')  THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRSOUTOFNETWORK,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND IFNULL(TRACKN_ONLY_DESCRIPTION,'NO') = 'NO' AND NETWORK_APPROVED = 'NO' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')  AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRSOUTOFNETWORKAGREED,
# MAGIC
# MAGIC --MEMBER AT FAULT REPAIRS  
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE IN ('MOTOR_REPAIR','WORK_PROVIDER') AND DC.LIABILITY_DECISION = 'FAULT' THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRS,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE IN ('MOTOR_REPAIR','WORK_PROVIDER') AND DC.LIABILITY_DECISION = 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSAGREED,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE IN ('MOTOR_REPAIR','WORK_PROVIDER') AND DC.LIABILITY_DECISION = 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSREFUSED,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE IN ('MOTOR_REPAIR','WORK_PROVIDER') AND DC.LIABILITY_DECISION = 'FAULT' AND IFNULL(TRACKN_ONLY_DESCRIPTION,'NO') = 'NO' AND NETWORK_APPROVED = 'YES' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')  THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSNETWORK,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE IN ('MOTOR_REPAIR','WORK_PROVIDER') AND DC.LIABILITY_DECISION = 'FAULT' AND IFNULL(TRACKN_ONLY_DESCRIPTION,'NO') = 'NO' AND NETWORK_APPROVED = 'YES' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED')  THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSSNETWORKAGREED,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE IN ('MOTOR_REPAIR','WORK_PROVIDER') AND DC.LIABILITY_DECISION = 'FAULT' AND IFNULL(TRACKN_ONLY_DESCRIPTION,'NO') = 'NO' AND NETWORK_APPROVED = 'NO' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')  THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSSOUTOFNETWORK,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE IN ('MOTOR_REPAIR','WORK_PROVIDER') AND DC.LIABILITY_DECISION = 'FAULT' AND IFNULL(TRACKN_ONLY_DESCRIPTION,'NO') = 'NO' AND NETWORK_APPROVED = 'NO' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')  AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSSOUTOFNETWORKAGREED,
# MAGIC 	 
# MAGIC -- NEW MEMBER AT FAULT REPAIRS PROCESS
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND JOB_COMPONENT_TYPE_DESCRIPTION IN ('AT FAULT SCHEME') AND DC.LIABILITY_DECISION = 'FAULT' THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSNEW,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND JOB_COMPONENT_TYPE_DESCRIPTION IN ('AT FAULT SCHEME') AND DC.LIABILITY_DECISION = 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSAGREEDNEW,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND JOB_COMPONENT_TYPE_DESCRIPTION IN ('AT FAULT SCHEME') AND DC.LIABILITY_DECISION = 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('ASSIGNED','ACCEPTED','DEPLOYED') THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSPENDINGNEW,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND JOB_COMPONENT_TYPE_DESCRIPTION IN ('AT FAULT SCHEME') AND DC.LIABILITY_DECISION = 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('ESTIMATED','ESTIMATE AUTHORISED','IN PROGRESS') THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSACCEPTEDNEW,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND JOB_COMPONENT_TYPE_DESCRIPTION IN ('AT FAULT SCHEME') AND DC.LIABILITY_DECISION = 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('INVOICE ENTERED','INVOICED','COMPLETE','SETTLED') THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSCOMPLETENEW,
# MAGIC SUM(CASE WHEN DC.CLAIM_NUMBER LIKE 'MEM%' AND DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND JOB_COMPONENT_TYPE_DESCRIPTION IN ('AT FAULT SCHEME') AND DC.LIABILITY_DECISION = 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS MEMATFAULTREPAIRSREFUSEDNEW,
# MAGIC
# MAGIC --SUBRO REPAIRS
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT') THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_APPOINTED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_AGREED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT') THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_DEPLOYED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_ACCEPTED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_INPROGRESS,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ESTIMATED' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_ESTIMATED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ESTIMATE AUTHORISED' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_ESTIMATEAUTHORISED, 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' AND COMPANY_NAME NOT IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRS_COMPLETED,
# MAGIC
# MAGIC -- CREDIT REPAIRS
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT') THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRSCREDIT,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_MOTORREPAIRSCREDIT_AGREED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT')  THEN 1 ELSE 0 END) AS FPJOB_CREDITREPAIRS_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_CREDITREPAIRS_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_CREDITREPAIRS_DEPLOYED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_CREDITREPAIRS_ACCEPTED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_CREDITREPAIRS_INPROGRESS,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ESTIMATED' AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_CREDITREPAIRS_ESTIMATED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ESTIMATE AUTHORISED' AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_CREDITREPAIRS_ESTIMATEAUTHORISED, 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'MOTOR_REPAIR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' AND COMPANY_NAME IN ('AX LTD','HERTZ ACCIDENT SUPPORT')THEN 1 ELSE 0 END) AS FPJOB_CREDITREPAIRS_COMPLETED,
# MAGIC
# MAGIC -- ALL TOW
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') THEN 1 ELSE 0 END) AS FPJOB_TOW_OFFERED_ALL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_TOW_AGREED_ALL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_TOW_DECLINED_ALL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_TOW_ASSIGNED_ALL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS FPJOB_TOW_DEPLOYED_ALL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_TOW_ACCEPTED_ALL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' THEN 1 ELSE 0 END) AS FPJOB_TOW_INPROGRESS_ALL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_TOW_COMPLETE_ALL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_TOW_REFUSED_ALL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY','AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_TOW_CANCELLED_ALL,
# MAGIC
# MAGIC --RECOVERY AGENTS
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_OFFERED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_AGREED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DECLINED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DEPLOYED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ACCEPTED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_INPROGRESS,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_COMPLETE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE','AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_CANCELLED,
# MAGIC
# MAGIC
# MAGIC --AA & NVA
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_OFFEREDAANVA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_AGREEDAANVA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DECLINEDAANVA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ASSIGNEDAANVA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DEPLOYEDAANVA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ACCEPTEDAANVA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_INPROGRESSAANVA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_COMPLETEAANVA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','REPUDIATED')  THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_REFUSEDAANVA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD','NATIONWIDE VEHICLE ASSISTANCE') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_CANCELLEDAANVA,
# MAGIC
# MAGIC -- AA TOW	 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_OFFEREDAA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_AGREEDAA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DECLINEDAA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ASSIGNEDAA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DEPLOYEDAA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ACCEPTEDAA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_INPROGRESSAA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_COMPLETEAA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_REFUSEDAA,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_CANCELLEDAA,
# MAGIC
# MAGIC -- NATIONWIDE ASSISTANCE	 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_OFFEREDNATIONWIDE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_AGREEDNATIONWIDE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DECLINEDNATIONWIDE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ASSIGNEDNATIONWIDE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DEPLOYEDNATIONWIDE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ACCEPTEDNATIONWIDE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_INPROGRESSNATIONWIDE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_COMPLETENATIONWIDE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','REPUDIATED')  THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_REFUSEDNATIONWIDE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'NATIONWIDE VEHICLE ASSISTANCE' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_CANCELLEDNATIONWIDE,
# MAGIC
# MAGIC -- NATWEST
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_OFFEREDNATWEST,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_AGREEDNATWEST,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DECLINEDNATWEST,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ASSIGNEDNATWEST,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_DEPLOYEDNATWEST,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_ACCEPTEDNATWEST,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_INPROGRESSNATWEST,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_COMPLETENATWEST,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_REFUSEDNATWEST,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME = 'AUTOMOBILE ASSOCIATION DEVELOPMENTS LTD - NATWEST/RBS RECOVERY' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERY_CANCELLEDNATWEST,
# MAGIC   
# MAGIC --PRE PAID TOW
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_OFFERED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_AGREED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_DECLINED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_DEPLOYED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_ACCEPTED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_INPROGRESS,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_COMPLETE,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION IN ('REFUSED','REPUDIATED')   THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'RECOVERY AGENTS' AND COMPANY_NAME IN ('AA MEM TOW PRE PAID') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED'  THEN 1 ELSE 0 END) AS MEMBER_TOW_PREPAID_CANCELLED,
# MAGIC
# MAGIC --SUBRO HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME <> ('CAR HIRE ADD-ON') THEN 1 ELSE 0 END) AS FPJOB_HIRE_TOTAL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME <> ('CAR HIRE ADD-ON') AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_HIRE_AGREED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' AND COMPANY_NAME <> ('CAR HIRE ADD-ON') THEN 1 ELSE 0 END) AS FPJOB_HIRE_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' AND COMPANY_NAME <> ('CAR HIRE ADD-ON') THEN 1 ELSE 0 END) AS FPJOB_HIRE_DEPLOYED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' AND COMPANY_NAME <> ('CAR HIRE ADD-ON') THEN 1 ELSE 0 END) AS FPJOB_HIRE_ACCEPTED, 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' AND COMPANY_NAME <> ('CAR HIRE ADD-ON') THEN 1 ELSE 0 END) AS FPJOB_HIRE_INPROGRESS, 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' AND COMPANY_NAME <> ('CAR HIRE ADD-ON') THEN 1 ELSE 0 END) AS FPJOB_HIRE_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' AND COMPANY_NAME <> ('CAR HIRE ADD-ON') THEN 1 ELSE 0 END) AS FPJOB_HIRE_COMPLETED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' AND COMPANY_NAME <> ('CAR HIRE ADD-ON') THEN 1 ELSE 0 END) AS FPJOB_HIRE_CANCELLED,
# MAGIC
# MAGIC --CREDIT HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_TOTAL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION NOT IN ('REFUSED','CANCELLED','REPUDIATED') THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_AGREED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_DEPLOYED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_ACCEPTED, 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_INPROGRESS, 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REPUDIATED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_REPUDIATED, 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_COMPLETED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_CANCELLED,
# MAGIC
# MAGIC --HIRES BY COMPANY
# MAGIC --AX LTD
# MAGIC --HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD'  THEN 1 ELSE 0 END) AS FPJOB_HIRE_AX_TOTAL,		
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_AX_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_AX_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_AX_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_HIRE_AX_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_AX_CANCELLED,
# MAGIC 			  
# MAGIC --CREDIT HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_AX_TOTAL,  
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_AX_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT'  AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_AX_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_AX_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_AX_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'AX LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_AX_CANCELLED,
# MAGIC
# MAGIC --KINDERTONS LTD 
# MAGIC --HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD'  THEN 1 ELSE 0 END) AS FPJOB_HIRE_KINDERTONS_TOTAL,		
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_KINDERTONS_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_KINDERTONS_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_KINDERTONS_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_HIRE_KINDERTONS_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_KINDERTONS_CANCELLED,
# MAGIC 			  
# MAGIC --CREDIT HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_KINDERTONS_TOTAL,  
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_KINDERTONS_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_KINDERTONS_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_KINDERTONS_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_KINDERTONS_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'KINDERTONS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_KINDERTONS_CANCELLED,
# MAGIC
# MAGIC --CHIEF VEHICLE RENTALS
# MAGIC --HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' THEN 1 ELSE 0 END) AS FPJOB_HIRE_CHIEF_TOTAL,	  	  
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_CHIEF_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_CHIEF_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_CHIEF_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_HIRE_CHIEF_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_CHIEF_CANCELLED,
# MAGIC
# MAGIC --CREDIT HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_CHIEF_TOTAL,		  
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_CHIEF_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_CHIEF_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_CHIEF_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_CHIEF_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'CHIEF VEHICLE RENTALS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_CHIEF_CANCELLED,
# MAGIC
# MAGIC --ENTERPRISE
# MAGIC --HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' THEN 1 ELSE 0 END) AS FPJOB_HIRE_ENTERPRISE_TOTAL,		  
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_ENTERPRISE_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_ENTERPRISE_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_ENTERPRISE_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_HIRE_ENTERPRISE_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_ENTERPRISE_CANCELLED,
# MAGIC 			  
# MAGIC --CREDIT HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_ENTERPRISE_TOTAL,		 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_ENTERPRISE_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_ENTERPRISE_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_ENTERPRISE_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_ENTERPRISE_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'ENTERPRISE RENT A CAR' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_ENTERPRISE_CANCELLED,
# MAGIC
# MAGIC --HERTZ
# MAGIC --HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' THEN 1 ELSE 0 END) AS FPJOB_HIRE_HERTZ_TOTAL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_HERTZ_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_HERTZ_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_HERTZ_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_HIRE_HERTZ_COMPLETED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_HERTZ_CANCELLED,
# MAGIC
# MAGIC --CREDIT HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_HERTZ_TOTAL,			  		  
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_HERTZ_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_HERTZ_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_HERTZ_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_HERTZ_COMPLETED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'HERTZ ACCIDENT SUPPORT' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_HERTZ_CANCELLED,
# MAGIC
# MAGIC --EUROPCAR GROUP UK
# MAGIC --HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' THEN 1 ELSE 0 END) AS FPJOB_HIRE_EUROPCAR_TOTAL,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_EUROPCAR_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_EUROPCAR_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_EUROPCAR_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_HIRE_EUROPCAR_COMPLETED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'HIRE CAR' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_HIRE_EUROPCAR_CANCELLED,
# MAGIC 			  
# MAGIC --CREDIT HIRES
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_EUROPCAR_TOTAL,	  		  
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_EUROPCAR_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_EUROPCAR_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_EUROPCAR_REFUSED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_EUROPCAR_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'CREDIT HIRE' AND DC.LIABILITY_DECISION <> 'FAULT' AND COMPANY_NAME = 'EUROPCAR GROUP UK LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS FPJOB_CREDITHIRE_EUROPCAR_CANCELLED,
# MAGIC
# MAGIC --SOLICITORS 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'GENERIC' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS FPJOB_SOLICITOR_ASSIGNED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'GENERIC' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS FPJOB_SOLICITOR_DEPLOYED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'GENERIC' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS FPJOB_SOLICITOR_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'GENERIC' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS FPJOB_SOLICITOR_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'GENERIC' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS FPJOB_SOLICITOR_REFUSED,
# MAGIC 			 
# MAGIC --SOLICITORS 
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'COM_SOLICITORS' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' AND COMPANY_NAME = 'KENNEDYS IQ LIMITED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERYMANAGER_DEPLOYED,
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'COM_SOLICITORS' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' AND COMPANY_NAME = 'KENNEDYS IQ LIMITED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERYMANAGER_ACCEPTED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'COM_SOLICITORS' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' AND COMPANY_NAME = 'KENNEDYS IQ LIMITED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERYMANAGER_COMPLETED,      
# MAGIC SUM(CASE WHEN DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND DJC.JOB_COMPONENT_TYPE_CODE = 'COM_SOLICITORS' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = 'SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' AND COMPANY_NAME = 'KENNEDYS IQ LIMITED' THEN 1 ELSE 0 END) AS FPJOB_RECOVERYMANAGER_REFUSED,
# MAGIC
# MAGIC --SOLICITORS HALSALLS
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MICHAEL W HALSALL SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS INJURY_MWH_ASSIGNED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MICHAEL W HALSALL SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS INJURY_MWH_DEPLOYED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MICHAEL W HALSALL SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS INJURY_MWH_ACCEPTED,      
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MICHAEL W HALSALL SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS INJURY_MWH_REFUSED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MICHAEL W HALSALL SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS INJURY_MWH_COMPLETED,
# MAGIC
# MAGIC --IRWIN MITCHELL
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME LIKE 'IRWIN MITCHELL%' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS INJURY_IM_ASSIGNED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME LIKE 'IRWIN MITCHELL%' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS INJURY_IM_DEPLOYED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME LIKE 'IRWIN MITCHELL%' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS INJURY_IM_ACCEPTED,      
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME LIKE 'IRWIN MITCHELL%' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS INJURY_IM_REFUSED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME LIKE 'IRWIN MITCHELL%' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS INJURY_IM_COMPLETED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'O''REILLY STEWART SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS INJURY_ORS_ASSIGNED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'O''REILLY STEWART SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS INJURY_ORS_DEPLOYED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'O''REILLY STEWART SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS INJURY_ORS_ACCEPTED,      
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'O''REILLY STEWART SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS INJURY_ORS_REFUSED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'O''REILLY STEWART SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS INJURY_ORS_COMPLETED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'BOTT AND CO SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS INJURY_BC_ASSIGNED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'BOTT AND CO SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS INJURY_BC_DEPLOYED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'BOTT AND CO SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS INJURY_BC_ACCEPTED,      
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'BOTT AND CO SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS INJURY_BC_REFUSED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'BOTT AND CO SOLICITORS LTD' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS INJURY_BC_COMPLETED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MINSTER LAW SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS INJURY_ML_ASSIGNED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MINSTER LAW SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS INJURY_ML_DEPLOYED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MINSTER LAW SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS INJURY_ML_ACCEPTED,      
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MINSTER LAW SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS INJURY_ML_REFUSED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'MINSTER LAW SOLICITORS' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS INJURY_ML_COMPLETED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'SLATER & GORDON SCOTLAND' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS INJURY_SG_ASSIGNED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'SLATER & GORDON SCOTLAND' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS INJURY_SG_DEPLOYED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'SLATER & GORDON SCOTLAND' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS INJURY_SG_ACCEPTED,      
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'SLATER & GORDON SCOTLAND' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS INJURY_SG_REFUSED,
# MAGIC SUM(CASE WHEN (TP_ROLE_DESCRIPTION IS NULL OR TP_ROLE_DESCRIPTION ='FIRST PARTY PASSENGER') AND JOB_TYPE = 'PI' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE IN ('SOLICITORS','PERSONAL INJURY SOLICITOR') AND COMPANY_NAME = 'SLATER & GORDON SCOTLAND' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS INJURY_SG_COMPLETED,
# MAGIC
# MAGIC --E2E
# MAGIC SUM(CASE WHEN  DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = ('SALVAGE AGENT') AND COMPANY_NAME = 'E2E' THEN 1 ELSE 0 END) AS E2E_APPOINTED,
# MAGIC SUM(CASE WHEN  DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = ('SALVAGE AGENT') AND COMPANY_NAME = 'E2E' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ASSIGNED' THEN 1 ELSE 0 END) AS E2E_ASSIGNED,
# MAGIC SUM(CASE WHEN  DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = ('SALVAGE AGENT') AND COMPANY_NAME = 'E2E' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'DEPLOYED' THEN 1 ELSE 0 END) AS E2E_DEPLOYED,
# MAGIC SUM(CASE WHEN  DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = ('SALVAGE AGENT') AND COMPANY_NAME = 'E2E' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'ACCEPTED' THEN 1 ELSE 0 END) AS E2E_ACCEPTED,
# MAGIC SUM(CASE WHEN  DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = ('SALVAGE AGENT') AND COMPANY_NAME = 'E2E' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'IN PROGRESS' THEN 1 ELSE 0 END) AS E2E_IN_PROGRESS,
# MAGIC SUM(CASE WHEN  DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = ('SALVAGE AGENT') AND COMPANY_NAME = 'E2E' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'COMPLETE' THEN 1 ELSE 0 END) AS E2E_COMPLETE,
# MAGIC SUM(CASE WHEN  DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = ('SALVAGE AGENT') AND COMPANY_NAME = 'E2E' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'REFUSED' THEN 1 ELSE 0 END) AS E2E_REFUSED,
# MAGIC SUM(CASE WHEN  DJOB.PARTY_TYPE = 'FIRST PARTY' AND JOB_TYPE = 'MOTOR' AND TJC.SERVICEPROVIDER_JOB_COMP_TYPE = ('SALVAGE AGENT') AND COMPANY_NAME = 'E2E' AND DJCS.JOB_COMPONENT_STATUS_DESCRIPTION = 'CANCELLED' THEN 1 ELSE 0 END) AS E2E_CANCELLED
# MAGIC
# MAGIC
# MAGIC
# MAGIC
# MAGIC FROM hive_metastore.ice_aas.ice_trn_job_component TJC
# MAGIC LEFT JOIN hive_metastore.ice_aas.ice_dim_job DJOB ON TJC.JOB_ID = DJOB.JOB_ID AND DJOB.CURRENT_FLAG = 'Y'
# MAGIC LEFT JOIN hive_metastore.ice_aas.ice_dim_job_component DJC ON TJC.JOB_COMPONENT_KEY = DJC.JOB_COMPONENT_KEY
# MAGIC LEFT JOIN hive_metastore.ice_aas.ice_dim_job_component_status DJCS ON TJC.JOB_COMPONENT_STATUS_KEY = DJCS.JOB_COMPONENT_STATUS_KEY
# MAGIC LEFT JOIN hive_metastore.ice_aas.ice_dim_serviceprovider DSP ON TJC.SERVICEPROVIDER_PARTY_KEY = DSP.SERVICEPROVIDER_KEY 
# MAGIC LEFT JOIN hive_metastore.ice_aas.ice_dim_claim DC ON DC.CLAIM_ID = TJC.CLAIM_ID AND DC.CURRENT_FLAG = 'Y'
# MAGIC LEFT JOIN hive_metastore.ice_aas.ice_dim_claim_party DCP ON DCP.PARTY_ID = DJOB.CNTCT_PARTY_ID AND DCP.CURRENT_FLAG = 'Y'
# MAGIC
# MAGIC WHERE  TJC.CURRENT_FLAG = 'Y'  AND COMPANY_NAME NOT IN ('ENTERPRISE RENT A CAR','CAR HIRE ADD-ON')
# MAGIC GROUP BY TJC.CLAIM_ID
# MAGIC )JOBCOMPONENTS ON DC.CLAIM_ID = JOBCOMPONENTS.CLAIM_ID
# MAGIC
# MAGIC  LEFT JOIN 
# MAGIC (
# MAGIC SELECT 
# MAGIC CLAIM_ID,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY REPAIRS' THEN RESERVE_AMOUNT ELSE 0 END) AS REPAIRRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY TOTAL LOSS' THEN RESERVE_AMOUNT ELSE 0 END) AS TOTALLOSSRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY VEHICLE RECOVERY' THEN RESERVE_AMOUNT ELSE 0 END) AS RECOVEREDVEHICLERESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY HIRE CAR' THEN RESERVE_AMOUNT ELSE 0 END) AS HIRECARRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY SALVAGE' THEN RESERVE_AMOUNT ELSE 0 END) AS SALVAGERESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION IN ('WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN RESERVE_AMOUNT ELSE 0 END) AS WINDSCREENRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION NOT IN ('FIRST PARTY REPAIRS','FIRST PARTY TOTAL LOSS','FIRST PARTY VEHICLE RECOVERY','FIRST PARTY HIRE CAR','FIRST PARTY SALVAGE','WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN RESERVE_AMOUNT ELSE 0 END) AS OTHERADRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY REPAIRS' THEN RESERVE_RECOVERY_AMOUNT ELSE 0 END) AS REPAIRRECOVERYRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY TOTAL LOSS' THEN RESERVE_RECOVERY_AMOUNT ELSE 0 END) AS TOTALLOSSRECOVERYRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY VEHICLE RECOVERY' THEN RESERVE_RECOVERY_AMOUNT ELSE 0 END) AS RECOVEREDVEHICLERECOVERYRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY HIRE CAR' THEN RESERVE_RECOVERY_AMOUNT ELSE 0 END) AS HIRECARRECOVERYRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY SALVAGE' THEN RESERVE_RECOVERY_AMOUNT ELSE 0 END) AS SALVAGERECOVERYRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION IN ('WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN RESERVE_RECOVERY_AMOUNT ELSE 0 END) AS WINDSCREENRECOVERYRESERVES,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION NOT IN ('FIRST PARTY REPAIRS','FIRST PARTY TOTAL LOSS','FIRST PARTY VEHICLE RECOVERY','FIRST PARTY HIRE CAR','FIRST PARTY SALVAGE','WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN RESERVE_RECOVERY_AMOUNT ELSE 0 END) AS OTHERADRECOVERYRESERVES
# MAGIC
# MAGIC FROM hive_metastore.ice_aas.ice_trn_reserve SNAR 
# MAGIC LEFT JOIN hive_metastore.ice_aas.ice_dim_head_of_damage HOD ON SNAR.HEAD_OF_DAMAGE_KEY = HOD.HEAD_OF_DAMAGE_KEY 
# MAGIC
# MAGIC WHERE SNAR.CURRENT_FLAG = 'Y'
# MAGIC GROUP BY CLAIM_ID
# MAGIC )ADRESERVES ON DC.CLAIM_ID = ADRESERVES.CLAIM_ID
# MAGIC
# MAGIC LEFT JOIN 
# MAGIC (
# MAGIC SELECT 
# MAGIC CLAIM_ID,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY REPAIRS' THEN REQUESTED_AMOUNT ELSE 0 END) AS REPAIRPAYMENTSREQUESTED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY TOTAL LOSS' THEN REQUESTED_AMOUNT ELSE 0 END) AS TOTALLOSSPAYMENTSREQUESTED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY VEHICLE RECOVERY' THEN REQUESTED_AMOUNT ELSE 0 END) AS RECOVEREDVEHICLEPAYMENTSREQUESTED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY HIRE CAR' THEN REQUESTED_AMOUNT ELSE 0 END) AS HIRECARPAYMENTSREQUESTED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY SALVAGE' THEN REQUESTED_AMOUNT ELSE 0 END) AS SALVAGEPAYMENTSREQUESTED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION IN ('WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN REQUESTED_AMOUNT ELSE 0 END) AS WINDSCREENPAYMENTSREQUESTED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION NOT IN ('FIRST PARTY REPAIRS','FIRST PARTY TOTAL LOSS','FIRST PARTY HIRE CAR','FIRST PARTY SALVAGE','WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN REQUESTED_AMOUNT ELSE 0 END) AS OTHERADPAYMENTSREQUESTED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY REPAIRS' THEN APPROVED_AMOUNT ELSE 0 END) AS REPAIRPAYMENTSAPPROVED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY TOTAL LOSS' THEN APPROVED_AMOUNT ELSE 0 END) AS TOTALLOSSPAYMENTSAPPROVED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY VEHICLE RECOVERY' THEN APPROVED_AMOUNT ELSE 0 END) AS RECOVEREDVEHICLEPAYMENTSAPPROVED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY HIRE CAR' THEN APPROVED_AMOUNT ELSE 0 END) AS HIRECARPAYMENTSAPPROVED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY SALVAGE' THEN APPROVED_AMOUNT ELSE 0 END) AS SALVAGEPAYMENTSAPPROVED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION IN ('WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN APPROVED_AMOUNT ELSE 0 END) AS WINDSCREENPAYMENTSAPPROVED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION NOT IN ('FIRST PARTY REPAIRS','FIRST PARTY TOTAL LOSS','FIRST PARTY VEHICLE RECOVERY','FIRST PARTY HIRE CAR','FIRST PARTY SALVAGE','WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN APPROVED_AMOUNT ELSE 0 END) AS OTHERADPAYMENTSAPPROVED,
# MAGIC SUM(APPROVED_AMOUNT) AS PAYMENTS
# MAGIC
# MAGIC FROM hive_metastore.ice_aas.ice_trn_payment SNAP 
# MAGIC LEFT JOIN hive_metastore.ice_aas.ice_dim_head_of_damage HOD ON SNAP.HEAD_OF_DAMAGE_KEY = HOD.HEAD_OF_DAMAGE_KEY 
# MAGIC
# MAGIC WHERE SNAP.CURRENT_FLAG = 'Y'
# MAGIC GROUP BY CLAIM_ID
# MAGIC ) ADPAYMENTS ON DC.CLAIM_ID = ADPAYMENTS.CLAIM_ID
# MAGIC
# MAGIC LEFT JOIN 
# MAGIC (
# MAGIC SELECT 
# MAGIC IFNULL(CLAIM_ID,0) AS CLAIM_ID,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY REPAIRS' THEN ALLOCATION_AMT ELSE 0 END) AS REPAIRPAYMENTSRECOVERED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY TOTAL LOSS' THEN ALLOCATION_AMT ELSE 0 END) AS TOTALLOSSPAYMENTSRECOVERED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY VEHICLE RECOVERY' THEN ALLOCATION_AMT ELSE 0 END) AS RECOVEREDVEHICLEPAYMENTSRECOVERED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY HIRE CAR' THEN ALLOCATION_AMT ELSE 0 END) AS HIRECARPAYMENTSRECOVERED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION = 'FIRST PARTY SALVAGE' THEN ALLOCATION_AMT ELSE 0 END) AS SALVAGEPAYMENTSRECOVERED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION IN ('WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN ALLOCATION_AMT ELSE 0 END) AS WINDSCREENPAYMENTSRECOVERED,
# MAGIC SUM(CASE WHEN HOD_DESCRIPTION NOT IN ('FIRST PARTY REPAIRS','FIRST PARTY TOTAL LOSS','FIRST PARTY VEHICLE RECOVERY','FIRST PARTY HIRE CAR','FIRST PARTY SALVAGE','WINDSCREEN REPAIR','WINDSCREEN REPLACE') THEN ALLOCATION_AMT ELSE 0 END) AS OTHERADPAYMENTSRECOVERED
# MAGIC
# MAGIC FROM hive_metastore.ice_aas.ice_trn_recovery SNAP 
# MAGIC LEFT JOIN hive_metastore.ice_aas.ice_dim_head_of_damage HOD ON SNAP.HEAD_OF_DAMAGE_KEY = HOD.HEAD_OF_DAMAGE_KEY 
# MAGIC
# MAGIC WHERE SNAP.CURRENT_FLAG = 'Y'
# MAGIC GROUP BY CLAIM_ID
# MAGIC
# MAGIC )ADRECOVERY ON DC.CLAIM_ID = ADRECOVERY.CLAIM_ID
# MAGIC
# MAGIC WHERE DC.CURRENT_FLAG = 'Y' 
# MAGIC )

# COMMAND ----------

# MAGIC %md
# MAGIC
